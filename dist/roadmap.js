!function(a){function e(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return a[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var t={};return e.m=a,e.c=t,e.p="",e(0)}([function(a,e,t){"use strict";function n(a){if(a&&a.__esModule)return a;var e={};if(null!=a)for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t]);return e["default"]=a,e}var r=t(1),i=n(r),o=t(2),s=n(o);$(function(){function a(){c.set(v)}function e(){var a=A.map(function(a){return{id:a.id,most:{value:null,visa:"???"},less:{value:null,visa:"???"}}}),e=function(e){return function(t,n){var r=t.fn(O[e]),i=a[n],o=i.most,s=i.less;(null===o.value||r>=o.value)&&(o.value=r,o.visa=e),(null===s.value||r<s.value)&&(s.value=r,s.visa=e)}};for(var t in O)A.forEach(e(t));a.forEach(function(a){$("#stats_most_"+a.id+" .stats-card-visa").text(a.most.visa),$("#stats_less_"+a.id+" .stats-card-visa").text(a.less.visa)})}function t(){for(var a=function(a,e){return e.total-a.total},e=Object.keys(k).map(function(a){return k[a]}).sort(a),t=function(t){var n=e[t],r=$("#stats_item_"+t),i=r.find(".stats-card-up"),o=r.find(".stats-card-down");if(n){r.removeClass("hidden").find(".stats-card-name").text(n.text).attr("title",n.total+" actions");var s=Object.keys(n.upUsers).map(function(a){return{total:n.upUsers[a],visa:a}}).sort(a)[0];s?i.removeClass("hidden").find(".stats-card-item-visa").text(s.visa):i.addClass("hidden");var d=Object.keys(n.downUsers).map(function(a){return{total:n.downUsers[a],visa:a}}).sort(a)[0];d?o.removeClass("hidden").find(".stats-card-item-visa").text(d.visa):o.addClass("hidden")}else r.addClass("hidden")},n=0;3>n;n++)t(n)}function n(e){return function(){var t=$(this).parents(".roadmap-item").data("index");if(null===t)return!1;var n=v[t];if(v[t]=v[t+e],v[t+e]=n,a(),w){var r=h.indexOf(n),i=f.push();i.set({visa:w,index:t,refIndex:r,value:n,time:Firebase.ServerValue.TIMESTAMP,direction:e})}return!1}}var r="room_"+window.location.hash.replace(/[\#\.\[\]\$]/g,""),o=-1!==window.location.host.indexOf("localhost")?"roadmap2":"amber-torch-7267",d=new Firebase("https://"+o+".firebaseio.com/"),l=d.child(r),c=l.child("roadmap"),u=l.child("reference"),m=l.child("threshold"),f=l.child("history"),p=l.child("presence"),v=[],h=[],g=0,_=!1;c.on("value",function(a){v=a.val()||[],s.renderRoadmap(v,g)}),u.on("value",function(a){h=a.val()||[],s.renderReference(h,g)}),m.on("value",function(a){g=a.val(),s.renderRoadmap(v,g),s.renderReference(h,g)}),f.limitToLast(1).on("child_added",function(a){var e=a.val();v.forEach(function(a,t){a===e.value&&s.renderActionNotification(t,e)}),$("#user_"+e.visa).removeClass("user-active"),setTimeout(function(){$("#user_"+e.visa).addClass("user-active")},10)});var w;d.onAuth(function(a){if(a){var e=a.uid;console.log("Authenticated user with uid:",e),d.child("users/"+e).on("value",function(a){w=a.val(),$("#main, nav, footer").removeClass("hidden"),$("#welcome").addClass("hidden"),$("#visa").text(w);var e=d.child(".info/connected"),t=l.child("presence/"+w);e.on("value",function(a){a.val()&&(t.onDisconnect().remove(),t.set(!0))})})}else $("#welcome").removeClass("hidden"),$("#visa_input").focus(),$("#main, #stats, nav, footer").addClass("hidden"),$("#admin_block").addClass("hidden")}),p.on("value",function(a){a&&s.displayOnline(a.val())});var x=c3.generate({data:{x:"x",columns:[["x"]],type:"area-spline"},axis:{y:{padding:0},x:{tick:{format:function(a){var e=1e4*a,t=new Date(e);return i.format2(t.getHours())+":"+i.format2(t.getMinutes())}}}},transition:{duration:100}}),C=[],y=[],b={},O={},k={},E=60,R=0;f.on("child_added",function(a){var e=a.val(),t=e.time,n=Date.now();if(!(n-t>72e4)){y.push(e);var r=e.visa,o=e.direction,s=e.value,d=i.getOrSet(O,r,{up:0,down:0,total:0,toRef:0,againstRef:0}),l=i.getOrSet(k,s,{up:0,total:0,upUsers:{},downUsers:{},text:s});d.total++,l.total++,o>0?(d.down++,i.getOrSet(l.downUsers,r,0),l.downUsers[r]++,e.index>=e.refIndex?d.againstRef++:d.toRef++):(l.up++,d.up++,i.getOrSet(l.upUsers,r,0),l.upUsers[r]++,e.index<=e.refIndex?d.againstRef++:d.toRef++),-1!==R&&R++>10&&($("#nav_stats").removeClass("hidden"),R=-1)}});var A=[{id:"active",fn:function(a){return a.total}},{id:"up",fn:function(a){return 100*a.up/a.total}},{id:"ref",fn:function(a){return 100*a.toRef/a.total}}];setInterval(function(){var a=Math.floor(Date.now()/1e4),n=[];if(!C.length)for(var r=0;E>r;r++)C.unshift(a-r);var i=C.indexOf(a);if(-1===i){C.push(a),C.shift();for(var o in b){var s=b[o];s.push(0),s.shift()}}if(y.forEach(function(a){var e=Math.floor(a.time/1e4),t=a.visa,r=C[C.length-1],o=C.indexOf(e);if(-1===o&&e>r)return void n.push(a);var s=b[t];s||(s=C.map(function(){return 0}),b[t]=s);var d=s[i];s[i]=d?d+1:1}),y=n,!_)return!1;var d=[["x"].concat(C)];for(var l in b)d.push([l].concat(b[l]));x.load({columns:d}),e(),t()},2e3),$("#nav_admin").on("click",function(){return $("#admin_block").toggleClass("hidden"),$("#main").toggleClass("admin"),$("#admin_roadmap_item").focus(),!1}),$("#admin_add").on("submit",function(){var e=$("#admin_roadmap_item"),t=e.val();return t&&(v.push(t),e.val(""),a()),!1}),$("#admin_threshold").on("submit",function(){var a=$("#admin_roadmap_threshold"),e=parseInt(a.val(),10);return isNaN(e)||(m.set(e),a.val("")),!1}),$("#nav_reference").on("click",function(){return u.set(v),!1}),$("#roadmap_items_download").on("click",function(){var a=JSON.stringify({ref:h,store:v,threshold:g});return i.downloadAsFile(new Blob([a],{type:"application/json"}),"roadmap.json"),!1}),$("body").on("dragover",function(a){var e=a.originalEvent;return e.dataTransfer.dropEffect="copy",!1}).on("drop",function(e){var t=e.originalEvent,n=t.dataTransfer.files[0],r=new FileReader;return r.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(n){return}t&&(m.set(t.threshold),u.set(t.ref),v=t.store,a())},r.readAsText(n),!1}),$("#roadmap_items").on("click",".roadmap-item-up",n(-1)).on("click",".roadmap-item-down",n(1)).on("click",".roadmap-item-delete",function(){var e=$(this).parents(".roadmap-item").data("index");return v.splice(e,1),a(),!1}).on("dragstart",".roadmap-item",function(a){if(!$("#main").hasClass("admin"))return!1;var e=a.originalEvent,t=$(this);t.addClass("roadmap-item-dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("application/json",JSON.stringify({index:t.data("index"),item:t.find(".roadmap-item-name").text()})),setTimeout(function(){$("#roadmap_items .roadmap-item:not(.roadmap-item-dragging)").addClass("roadmap-item-drop-target")},100)}).on("dragenter",".roadmap-item",function(){var a=$(this);a.hasClass("roadmap-item-drop-target")&&$(this).addClass("roadmap-item-drop-target-enter")}).on("dragover",".roadmap-item",function(a){var e=a.originalEvent;return e.dataTransfer.dropEffect="move",!1}).on("dragleave",".roadmap-item",function(a){a.preventDefault(),a.stopPropagation();var e=$(this);e.removeClass("roadmap-item-drop-target-enter")}).on("dragend",".roadmap-item",function(){$(this).removeClass("roadmap-item-dragging"),$("#roadmap_items .roadmap-item").removeClass("roadmap-item-drop-target").removeClass("roadmap-item-drop-target-enter")}).on("drop",".roadmap-item",function(e){var t=e.originalEvent,n=$(this).data("index"),r=JSON.parse(t.dataTransfer.getData("application/json")).index;0===n||n||(n=v.length),n>r&&n--;var i=v.splice(r,1);return v.splice(n,0,i),a(),!1}),$("#welcome form").on("submit",function(a){a.preventDefault(),$(this).hide(),$("#welcome .progress").removeClass("hidden");var e=$("#visa_input").val();d.authAnonymously(function(a,t){if(a)return void console.log("Authentication Failed!",a);var n=t.uid;d.child("users/"+n).set(e),$("#welcome").hide(),$("#welcome form").show(),$("#welcome").addClass("hidden"),$("#welcome .progress").addClass("hidden")})}),$("#nav_logout").on("click",function(){return d.unauth(),!1}),$("#nav_stats, #stats h2 .close").on("click",function(){return $("#stats, #main").toggleClass("hidden"),_=!_,_&&(e(),t(),$("#main").hasClass("admin")&&$("#nav_admin").trigger("click")),!1}),$("#nav_toggle").on("click",function(){$("nav .navbar-right").toggleClass("hidden-xs")})})},function(a,e){"use strict";function t(a){return 10>a?"0"+a:""+a}function n(a,e){var t=window.saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator);if(t)t(a,e);else{var n=document.createElement("a"),r=window.URL.createObjectURL(a);n.setAttribute("href",r),n.setAttribute("download",e),document.body.appendChild(n),n.click(),document.body.removeChild(n)}}function r(a,e,t){var n=a[e];return n?n:(a[e]=t,t)}Object.defineProperty(e,"__esModule",{value:!0}),e.format2=t,e.downloadAsFile=n,e.getOrSet=r},function(a,e){"use strict";function t(a,e,t,n,r,i){var o=['<div class="roadmap-item clearfix '+(i?"roadmap-item-candidate":"")+'"'+(r?"":'id="roadmap_item_'+e+'"')+'  draggable="true">',"<div>"];if(r||o.push('<span class="roadmap-item-grab-handle glyphicon glyphicon-move"></span>'),o.push('<span class="roadmap-item-name"></span>'),!r){var s=t&&t-1!==e;o=o.concat(['<span class="roadmap-author"></span>',s?'<a href="#" class="roadmap-item-down">':"",s?'<span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>':"",s?"</a>":"",e?'<a href="#" class="roadmap-item-up">':"",e?'<span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>':"",e?"</a>":"",'<a href="#" class="roadmap-item-delete">','<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>',"</a>"])}o.push("</div></div>");var d=$(o.join(""));return d.data("index",e),d.find(".roadmap-item-name").text(a),d.attr("title",a),n&&d.addClass("roadmap-item-new"),d}function n(a,e){var n=$("#roadmap_items"),r=[],i=a.length;n.html(""),i?($("#roadmap_items_tips").addClass("hidden"),a.forEach(function(a,o){e&&o===e&&n.append(d),n.append(t(a,o,i,s[o]!==a,!1,o>=e)),r[o]=a}),n.append('<div class="roadmap-item clearfix"></div>')):$("#roadmap_items_tips").removeClass("hidden"),s=r}function r(a,e){var n=$("#reference_items");n.html(""),a.forEach(function(a,r){e&&r===e&&n.append(d),n.append(t(a,r,null,!0,!0,r>=e))})}function i(a){var e=$("#online");e.html("");for(var t in a)a[t]&&e.append('<li id="user_'+t+'">'+t+"</li>")}function o(a,e){var t=$("#roadmap_item_"+a+" > div");t.removeClass("roadmap-item-notif-up, roadmap-item-notif-down"),$(".roadmap-author",t).text(e.visa).removeClass("roadmap-author-new"),setTimeout(function(){t.addClass("roadmap-item-notif-"+(e.direction<0?"up":"down")),$(".roadmap-author",t).addClass("roadmap-author-new")},10)}Object.defineProperty(e,"__esModule",{value:!0}),e.createElement=t,e.renderRoadmap=n,e.renderReference=r,e.displayOnline=i,e.renderActionNotification=o;var s=[],d="<h5>Candidates</h5>"}]);
//# sourceMappingURL=roadmap.js.map