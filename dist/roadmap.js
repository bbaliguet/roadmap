!function(a){function e(t){if(n[t])return n[t].exports;var r=n[t]={exports:{},id:t,loaded:!1};return a[t].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=a,e.c=n,e.p="",e(0)}([function(a,e,n){"use strict";function t(a){if(a&&a.__esModule)return a;var e={};if(null!=a)for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);return e["default"]=a,e}var r=n(1),i=t(r),o=n(2),d=t(o);$(function(){function a(){l.set(f)}function e(){var a=O.map(function(a){return{id:a.id,most:{value:null,visa:"???"},less:{value:null,visa:"???"}}}),e=function(e){return function(n,t){var r=n.fn(b[e]),i=a[t],o=i.most,d=i.less;(null===o.value||r>=o.value)&&(o.value=r,o.userVisa=e),(null===d.value||r<d.value)&&(d.value=r,d.userVisa=e)}};for(var n in b)O.forEach(e(n));a.forEach(function(a){$("#stats_most_"+a.id+" .stats-card-visa").text(a.most.visa),$("#stats_less_"+a.id+" .stats-card-visa").text(a.less.visa)})}function n(e){return function(){var n=$(this).parents(".roadmap-item").data("index");if(null===n)return!1;var t=f[n];if(f[n]=f[n+e],f[n+e]=t,a(),_){var r=v.indexOf(t),i=m.push();i.set({visa:_,index:n,refIndex:r,value:t,time:Firebase.ServerValue.TIMESTAMP,direction:e})}return!1}}var t="room_"+window.location.hash.replace(/[\#\.\[\]\$]/g,""),r=-1!==window.location.host.indexOf("localhost")?"roadmap2":"amber-torch-7267",o=new Firebase("https://"+r+".firebaseio.com/"),s=o.child(t),l=s.child("roadmap"),c=s.child("reference"),u=s.child("threshold"),m=s.child("history"),p=s.child("presence"),f=[],v=[],h=0,g=!1;l.on("value",function(a){f=a.val()||[],d.renderRoadmap(f,h)}),c.on("value",function(a){v=a.val()||[],d.renderReference(v,h)}),u.on("value",function(a){h=a.val(),d.renderRoadmap(f,h),d.renderReference(v,h)}),m.limitToLast(1).on("child_added",function(a){var e=a.val();f.forEach(function(a,n){a===e.value&&d.renderActionNotification(n,e)}),$("#user_"+e.visa).removeClass("user-active"),setTimeout(function(){$("#user_"+e.visa).addClass("user-active")},10)});var _;o.onAuth(function(a){if(a){var e=a.uid;console.log("Authenticated user with uid:",e),o.child("users/"+e).on("value",function(a){_=a.val(),$("#main, nav, footer").removeClass("hidden"),$("#welcome").addClass("hidden"),$("#visa").text(_);var e=o.child(".info/connected"),n=s.child("presence/"+_);e.on("value",function(a){a.val()&&(n.onDisconnect().remove(),n.set(!0))})})}else $("#welcome").removeClass("hidden"),$("#visa_input").focus(),$("#main, #stats, nav, footer").addClass("hidden"),$("#admin_block").addClass("hidden")}),p.on("value",function(a){a&&d.displayOnline(a.val())});var w=c3.generate({data:{x:"x",columns:[["x"]],type:"area-spline"},axis:{y:{padding:0},x:{tick:{format:function(a){var e=1e4*a,n=new Date(e);return i.format2(n.getHours())+":"+i.format2(n.getMinutes())}}}},transition:{duration:100}}),x=[],C=[],y={},b={},E=60;m.on("child_added",function(a){var e=a.val();C.push(e);var n=e.visa,t=b[n];t||(t={up:0,down:0,total:0,toRef:0,againstRef:0},b[n]=t),t.total++,e.direction>0?(t.down++,e.index>=e.refIndex?t.againstRef++:t.toRef++):(t.up++,e.index<=e.refIndex?t.againstRef++:t.toRef++)});var O=[{id:"active",fn:function(a){return a.total}},{id:"up",fn:function(a){return 100*a.up/a.total}},{id:"ref",fn:function(a){return 100*a.toRef/a.total}}];setInterval(function(){var a=Math.floor(Date.now()/1e4),n=[];if(!x.length)for(var t=0;E>t;t++)x.unshift(a-t);var r=x.indexOf(a);if(-1===r&&(x.push(a),x.shift(),Object.keys(y).forEach(function(a){var e=y[a];e.push(0),e.shift()})),C.forEach(function(e){var t=Math.floor(e.time/1e4),r=e.visa,i=x[x.length-1],o=x.indexOf(t);if(-1===o&&a>i)return void n.push(e);var d=y[r];d||(d=x.map(function(){return 0}),y[r]=d);var s=d[o];d[o]=s?s+1:1}),C=n,!g)return!1;var i=[["x"].concat(x)];for(var o in y)i.push([o].concat(y[o]));w.load({columns:i}),e()},2e3),$("#nav_admin").on("click",function(){return $("#admin_block").toggleClass("hidden"),$("#main").toggleClass("admin"),$("#admin_roadmap_item").focus(),!1}),$("#admin_add").on("submit",function(){var e=$("#admin_roadmap_item"),n=e.val();return n&&(f.push(n),e.val(""),a()),!1}),$("#admin_threshold").on("submit",function(){var a=$("#admin_roadmap_threshold"),e=parseInt(a.val(),10);return isNaN(e)||(u.set(e),a.val("")),!1}),$("#nav_reference").on("click",function(){return c.set(f),!1}),$("#roadmap_items_download").on("click",function(){var a=JSON.stringify({ref:v,store:f,threshold:h});return i.downloadAsFile(new Blob([a],{type:"application/json"}),"roadmap.json"),!1}),$("body").on("dragover",function(a){var e=a.originalEvent;return e.dataTransfer.dropEffect="copy",!1}).on("drop",function(e){var n=e.originalEvent,t=n.dataTransfer.files[0],r=new FileReader;return r.onload=function(e){var n=null;try{n=JSON.parse(e.target.result)}catch(t){return}n&&(u.set(n.threshold),c.set(n.ref),f=n.store,a())},r.readAsText(t),!1}),$("#roadmap_items").on("click",".roadmap-item-up",n(-1)).on("click",".roadmap-item-down",n(1)).on("click",".roadmap-item-delete",function(){var e=$(this).parents(".roadmap-item").data("index");return f.splice(e,1),a(),!1}).on("dragstart",".roadmap-item",function(a){if(!$("#main").hasClass("admin"))return!1;var e=a.originalEvent,n=$(this);n.addClass("roadmap-item-dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("application/json",JSON.stringify({index:n.data("index"),item:n.find(".roadmap-item-name").text()})),setTimeout(function(){$("#roadmap_items .roadmap-item:not(.roadmap-item-dragging)").addClass("roadmap-item-drop-target")},100)}).on("dragenter",".roadmap-item",function(){var a=$(this);a.hasClass("roadmap-item-drop-target")&&$(this).addClass("roadmap-item-drop-target-enter")}).on("dragover",".roadmap-item",function(a){var e=a.originalEvent;return e.dataTransfer.dropEffect="move",!1}).on("dragleave",".roadmap-item",function(a){a.preventDefault(),a.stopPropagation();var e=$(this);e.removeClass("roadmap-item-drop-target-enter")}).on("dragend",".roadmap-item",function(){$(this).removeClass("roadmap-item-dragging"),$("#roadmap_items .roadmap-item").removeClass("roadmap-item-drop-target").removeClass("roadmap-item-drop-target-enter")}).on("drop",".roadmap-item",function(e){var n=e.originalEvent,t=$(this).data("index"),r=JSON.parse(n.dataTransfer.getData("application/json")).index;0===t||t||(t=f.length),t>r&&t--;var i=f.splice(r,1);return f.splice(t,0,i),a(),!1}),$("#welcome form").on("submit",function(a){a.preventDefault(),$(this).hide(),$("#welcome .progress").removeClass("hidden");var e=$("#visa_input").val();o.authAnonymously(function(a,n){if(a)return void console.log("Authentication Failed!",a);var t=n.uid;o.child("users/"+t).set(e),$("#welcome").hide(),$("#welcome form").show(),$("#welcome").addClass("hidden"),$("#welcome .progress").addClass("hidden")})}),$("#nav_logout").on("click",function(){return o.unauth(),!1}),$("#nav_stats, #stats h2 .close").on("click",function(){return $("#stats, #main").toggleClass("hidden"),g=!g,e&&(e(),$("#main").hasClass("admin")&&$("#nav_admin").trigger("click")),!1}),$("#nav_toggle").on("click",function(){$("nav .navbar-right").toggleClass("hidden-xs")})})},function(a,e){"use strict";function n(a){return 10>a?"0"+a:""+a}function t(a,e){var n=window.saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator);if(n)n(a,e);else{var t=document.createElement("a"),r=window.URL.createObjectURL(a);t.setAttribute("href",r),t.setAttribute("download",e),document.body.appendChild(t),t.click(),document.body.removeChild(t)}}Object.defineProperty(e,"__esModule",{value:!0}),e.format2=n,e.downloadAsFile=t},function(a,e){"use strict";function n(a,e,n,t,r,i){var o=['<div class="roadmap-item clearfix '+(i?"roadmap-item-candidate":"")+'"'+(r?"":'id="roadmap_item_'+e+'"')+'  draggable="true">',"<div>"];if(r||o.push('<span class="roadmap-item-grab-handle glyphicon glyphicon-move"></span>'),o.push('<span class="roadmap-item-name"></span>'),!r){var d=n&&n-1!==e;o=o.concat(['<span class="roadmap-author"></span>',d?'<a href="#" class="roadmap-item-down">':"",d?'<span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>':"",d?"</a>":"",e?'<a href="#" class="roadmap-item-up">':"",e?'<span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>':"",e?"</a>":"",'<a href="#" class="roadmap-item-delete">','<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>',"</a>"])}o.push("</div></div>");var s=$(o.join(""));return s.data("index",e),s.find(".roadmap-item-name").text(a),s.attr("title",a),t&&s.addClass("roadmap-item-new"),s}function t(a,e){var t=$("#roadmap_items"),r=[],i=a.length;t.html(""),i?($("#roadmap_items_tips").addClass("hidden"),a.forEach(function(a,o){e&&o===e&&t.append(s),t.append(n(a,o,i,d[o]!==a,!1,o>=e)),r[o]=a}),t.append('<div class="roadmap-item clearfix"></div>')):$("#roadmap_items_tips").removeClass("hidden"),d=r}function r(a,e){var t=$("#reference_items");t.html(""),a.forEach(function(a,r){e&&r===e&&t.append(s),t.append(n(a,r,null,!0,!0,r>=e))})}function i(a){var e=$("#online");e.html("");for(var n in a)a[n]&&e.append('<li id="user_'+n+'">'+n+"</li>")}function o(a,e){var n=$("#roadmap_item_"+a+" > div");n.removeClass("roadmap-item-notif-up, roadmap-item-notif-down"),$(".roadmap-author",n).text(e.visa).removeClass("roadmap-author-new"),setTimeout(function(){n.addClass("roadmap-item-notif-"+(e.direction<0?"up":"down")),$(".roadmap-author",n).addClass("roadmap-author-new")},10)}Object.defineProperty(e,"__esModule",{value:!0}),e.createElement=n,e.renderRoadmap=t,e.renderReference=r,e.displayOnline=i,e.renderActionNotification=o;var d=[],s="<h5>Candidates</h5>"}]);
//# sourceMappingURL=roadmap.js.map