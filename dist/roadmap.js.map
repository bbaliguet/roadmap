{"version":3,"sources":["webpack:///roadmap.js","webpack:///webpack/bootstrap 46666c62e8273f7a9d0f","webpack:///C:/Users/BBA/Documents/GitHub/roadmap/source/js/roadmap.js","webpack:///C:/Users/BBA/Documents/GitHub/roadmap/source/js/helper.js","webpack:///C:/Users/BBA/Documents/GitHub/roadmap/source/js/view.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_interopRequireWildcard","obj","__esModule","newObj","key","Object","prototype","hasOwnProperty","_helper","helper","_view","view","$","broadcast","roadmap","set","store","showUserStats","stats","statRules","map","rule","most","value","visa","less","handleRule","currentVisa","index","fn","userStats","stat","userVisa","forEach","text","showItemStats","totalSort","a","b","total","items","keys","itemStats","sort","_loop","item","$container","$upContainer","find","$downContainer","removeClass","attr","upUser","upUsers","addClass","downUser","downUsers","swap","direction","this","parents","data","refIndex","storeReference","indexOf","historyRef","history","push","time","Firebase","ServerValue","TIMESTAMP","hash","window","location","replace","baseDomain","host","base","room","child","reference","threshold","presence","thresholdValue","showingStats","on","newStoreResp","val","renderRoadmap","renderReference","limitToLast","childSnapshot","event","renderActionNotification","setTimeout","onAuth","authData","uid","console","log","amOnline","userRef","snapshot","onDisconnect","remove","focus","displayOnline","chart","c3","generate","x","columns","type","axis","y","padding","tick","format","date","Date","format2","getHours","getMinutes","transition","duration","times","saved","users","nbPoints","historyLength","now","eventVisa","user","getOrSet","up","down","toRef","againstRef","setInterval","Math","floor","remaining","length","i","unshift","shift","eventTime","lastTime","timeIndex","currentStats","concat","load","toggleClass","$item","parseInt","isNaN","content","JSON","stringify","ref","downloadAsFile","Blob","originalEvent","dataTransfer","dropEffect","file","files","reader","FileReader","onload","e","parse","target","result","X_x","readAsText","splice","hasClass","effectAllowed","setData","$this","preventDefault","stopPropagation","targetIndex","originIndex","getData","hide","login","authAnonymously","error","show","unauth","trigger","int","filename","saveAs","navigator","msSaveBlob","bind","downloadLink","document","createElement","href","URL","createObjectURL","setAttribute","body","appendChild","click","removeChild","object","defaultValue","defineProperty","changed","isReference","isCandidate","markup","isNotLast","$element","join","$elementContainer","newStoreView","nbItems","html","append","thresholdMarkup","storeView","online","$online"],"mappings":"CAAS,SAAUA,GCInB,QAAAC,GAAAC,GAGA,GAAAC,EAAAD,GACA,MAAAC,GAAAD,GAAAE,OAGA,IAAAC,GAAAF,EAAAD,IACAE,WACAE,GAAAJ,EACAK,QAAA,EAUA,OANAP,GAAAE,GAAAM,KAAAH,EAAAD,QAAAC,IAAAD,QAAAH,GAGAI,EAAAE,QAAA,EAGAF,EAAAD,QAvBA,GAAAD,KAqCA,OATAF,GAAAQ,EAAAT,EAGAC,EAAAS,EAAAP,EAGAF,EAAAU,EAAA,GAGAV,EAAA,KDMM,SAASI,EAAQD,EAASH,GAG/B,YAEA,SAASW,GAAwBC,GAAO,GAAIA,GAAOA,EAAIC,WAAc,MAAOD,EAAc,IAAIE,KAAa,IAAW,MAAPF,EAAe,IAAK,GAAIG,KAAOH,GAAWI,OAAOC,UAAUC,eAAeX,KAAKK,EAAKG,KAAMD,EAAOC,GAAOH,EAAIG,GAAmC,OAAzBD,GAAO,WAAaF,EAAYE,EAErQ,GAAIK,GAAUnB,EElDS,GAAZoB,EAAMT,EAAAQ,GFsDbE,EAAQrB,EErDS,GAAVsB,EAAIX,EAAAU,EAEhBE,GAAE,WA8CD,QAASC,KACRC,EAAQC,IAAIC,GA0Kb,QAASC,KACR,GAAIC,GAAQC,EAAUC,IAAI,SAASC,GAClC,OACC3B,GAAI2B,EAAK3B,GACT4B,MACCC,MAAO,KACPC,KAAM,OAEPC,MACCF,MAAO,KACPC,KAAM,UAKLE,EAAa,SAASC,GACzB,MAAO,UAASN,EAAMO,GACrB,GAAIL,GAAQF,EAAKQ,GAAGC,EAAUH,IAC1BI,EAAOb,EAAMU,GACbN,EAAOS,EAAKT,KACZG,EAAOM,EAAKN,MACG,OAAfH,EAAKC,OAAkBA,GAASD,EAAKC,SACxCD,EAAKC,MAAQA,EACbD,EAAKE,KAAOG,IAEM,OAAfF,EAAKF,OAAkBA,EAAQE,EAAKF,SACvCE,EAAKF,MAAQA,EACbE,EAAKD,KAAOG,IAIf,KAAK,GAAIK,KAAYF,GACpBX,EAAUc,QAAQP,EAAWM,GAG9Bd,GAAMe,QAAQ,SAASF,GACtBnB,EAAE,eAAiBmB,EAAKrC,GAAK,qBAAqBwC,KAAKH,EAAKT,KAAKE,MACjEZ,EAAE,eAAiBmB,EAAKrC,GAAK,qBAAqBwC,KAAKH,EAAKN,KAAKD,QAInE,QAASW,KAMR,IAAK,GALDC,GAAY,SAACC,EAAGC,GFoDlB,MEpDwBA,GAAEC,MAAQF,EAAEE,OAElCC,EAAQnC,OAAOoC,KAAKC,GAAWtB,IAAI,SAAAhB,GFsDrC,MEtD4CsC,GAAUtC,KACtDuC,KAAKP,GFwDFQ,EAAQ,SEtDJhB,GACR,GAAIiB,GAAOL,EAAMZ,GACbkB,EAAalC,EAAC,eAAgBgB,GAC9BmB,EAAeD,EAAWE,KAAK,kBAC/BC,EAAiBH,EAAWE,KAAK,mBACrC,IAAKH,EAEE,CACNC,EAAWI,YAAY,UACrBF,KAAK,oBACLd,KAAKW,EAAKX,MACViB,KAAK,QAAYN,EAAKN,MAAK,WAG7B,IAAIa,GAAS/C,OAAOoC,KAAKI,EAAKQ,SAASjC,IAAI,SAAAhB,GFoDzC,OEnDDmC,MAAOM,EAAKQ,QAAQjD,GACpBoB,KAAMpB,KACHuC,KAAKP,GAAW,EAChBgB,GACHL,EAAaG,YAAY,UAAUF,KAAK,yBAAyBd,KAAKkB,EAAO5B,MAE7EuB,EAAaO,SAAS,SAEvB,IAAIC,GAAWlD,OAAOoC,KAAKI,EAAKW,WAAWpC,IAAI,SAAAhB,GFsD7C,OErDDmC,MAAOM,EAAKW,UAAUpD,GACtBoB,KAAMpB,KACHuC,KAAKP,GAAW,EAChBmB,GACHN,EAAeC,YAAY,UAAUF,KAAK,yBAAyBd,KAAKqB,EAAS/B,MAEjFyB,EAAeK,SAAS,cAxBzBR,GAAWQ,SAAS,WANb1B,EAAQ,EAAW,EAARA,EAAWA,IF2F7BgB,EE3FOhB,GAuLV,QAAS6B,GAAKC,GACb,MAAO,YACN,GAAI9B,GAAQhB,EAAE+C,MAAMC,QAAQ,iBAAiBC,KAAK,QAClD,IAAc,OAAVjC,EACH,OAAO,CAGR,IAAIL,GAAQP,EAAMY,EAKlB,IAJAZ,EAAMY,GAASZ,EAAMY,EAAQ8B,GAC7B1C,EAAMY,EAAQ8B,GAAanC,EAC3BV,IAEIW,EAAM,CACT,GAAIsC,GAAWC,EAAeC,QAAQzC,GAClC0C,EAAaC,EAAQC,MACzBF,GAAWlD,KACVS,KAAMA,EACNI,MAAOA,EACPkC,SAAUA,EACVvC,MAAOA,EACP6C,KAAMC,SAASC,YAAYC,UAC3Bb,UAAWA,IAGb,OAAO,GArdT,GAAIc,GAAO,QAAUC,OAAOC,SAASF,KAAKG,QAAQ,gBAAiB,IAE/DC,EAA2D,KAA9CH,OAAOC,SAASG,KAAKb,QAAQ,aAAsB,WAAa,mBAE7Ec,EAAO,GAAIT,UAAS,WAAaO,EAAa,oBAC9CG,EAAOD,EAAKE,MAAMR,GAClB1D,EAAUiE,EAAKC,MAAM,WACrBC,EAAYF,EAAKC,MAAM,aACvBE,EAAYH,EAAKC,MAAM,aACvBd,EAAUa,EAAKC,MAAM,WACrBG,EAAWJ,EAAKC,MAAM,YAQtBhE,KACA+C,KACAqB,EAAiB,EACjBC,GAAe,CAQnBvE,GAAQwE,GAAG,QAAS,SAASC,GAC5BvE,EAAQuE,EAAaC,UACrB7E,EAAK8E,cAAczE,EAAOoE,KAE3BH,EAAUK,GAAG,QAAS,SAASzB,GAC9BE,EAAiBF,EAAK2B,UACtB7E,EAAK+E,gBAAgB3B,EAAgBqB,KAGtCF,EAAUI,GAAG,QAAS,SAASzB,GAC9BuB,EAAiBvB,EAAK2B,MACtB7E,EAAK8E,cAAczE,EAAOoE,GAC1BzE,EAAK+E,gBAAgB3B,EAAgBqB,KAMtClB,EAAQyB,YAAY,GAAGL,GAAG,cAAe,SAASM,GACjD,GAAIC,GAAQD,EAAcJ,KAC1BxE,GAAMiB,QAAQ,SAASC,EAAMN,GACxBM,IAAS2D,EAAMtE,OAClBZ,EAAKmF,yBAAyBlE,EAAOiE,KAIvCjF,EAAE,SAAWiF,EAAMrE,MAAM0B,YAAY,eACrC6C,WAAW,WACVnF,EAAE,SAAWiF,EAAMrE,MAAM8B,SAAS,gBAChC,KAIJ,IAAI9B,EACJsD,GAAKkB,OAAO,SAASC,GACpB,GAAIA,EAAU,CACb,GAAIC,GAAMD,EAASC,GACnBC,SAAQC,IAAI,+BAAgCF,GAC5CpB,EAAKE,MAAM,SAAWkB,GAAKZ,GAAG,QAAS,SAASzB,GAC/CrC,EAAOqC,EAAK2B,MACZ5E,EAAE,sBAAsBsC,YAAY,UACpCtC,EAAE,YAAY0C,SAAS,UACvB1C,EAAE,SAASsB,KAAKV,EAGhB,IAAI6E,GAAWvB,EAAKE,MAAM,mBACtBsB,EAAUvB,EAAKC,MAAM,YAAcxD,EACvC6E,GAASf,GAAG,QAAS,SAASiB,GACzBA,EAASf,QACZc,EAAQE,eAAeC,SACvBH,EAAQvF,KAAI,YAKfH,GAAE,YAAYsC,YAAY,UAC1BtC,EAAE,eAAe8F,QACjB9F,EAAE,8BAA8B0C,SAAS,UACzC1C,EAAE,gBAAgB0C,SAAS,YAG7B6B,EAASG,GAAG,QAAS,SAASzB,GACzBA,GACHlD,EAAKgG,cAAc9C,EAAK2B,QAS1B,IAAIoB,GAAQC,GAAGC,UACdjD,MACCkD,EAAG,IACHC,UACE,MAEFC,KAAM,eAEPC,MACCC,GACCC,QAAS,GAEVL,GACCM,MACCC,OAAQ,SAASP,GAChB,GAAI3C,GAAW,IAAJ2C,EACPQ,EAAO,GAAIC,MAAKpD,EACpB,OAAO3D,GAAOgH,QAAQF,EAAKG,YAAc,IAAMjH,EAAOgH,QAAQF,EAAKI,kBAKvEC,YACCC,SAAU,OAKRC,KACAC,KACAC,KACAlG,KACAY,KACAuF,EAAW,GACXC,EAAgB,CAEpBhE,GAAQoB,GAAG,cAAe,SAASM,GAClC,GAAIC,GAAQD,EAAcJ,MACtBpB,EAAOyB,EAAMzB,KACb+D,EAAMX,KAAKW,KAGf,MAAIA,EAAM/D,EAAO,MAAjB,CAIA2D,EAAM5D,KAAK0B,EAEX,IAAIuC,GAAYvC,EAAMrE,KAClBkC,EAAYmC,EAAMnC,UAClBxB,EAAO2D,EAAMtE,MACb8G,EAAO5H,EAAO6H,SAASxG,EAAWsG,GACrCG,GAAI,EACJC,KAAM,EACNjG,MAAO,EACPkG,MAAO,EACPC,WAAY,IAET7F,EAAOpC,EAAO6H,SAAS5F,EAAWR,GACrCqG,GAAI,EACJhG,MAAO,EACPc,WACAG,aACAtB,KAAMA,GAGPmG,GAAK9F,QACLM,EAAKN,QAEDmB,EAAY,GACf2E,EAAKG,OACL/H,EAAO6H,SAASzF,EAAKW,UAAW4E,EAAW,GAC3CvF,EAAKW,UAAU4E,KACXvC,EAAMjE,OAASiE,EAAM/B,SACxBuE,EAAKK,aAELL,EAAKI,UAGN5F,EAAK0F,KACLF,EAAKE,KACL9H,EAAO6H,SAASzF,EAAKQ,QAAS+E,EAAW,GACzCvF,EAAKQ,QAAQ+E,KACTvC,EAAMjE,OAASiE,EAAM/B,SACxBuE,EAAKK,aAELL,EAAKI,SAKe,KAAlBP,GAAwBA,IAAkB,KAC7CtH,EAAE,cAAcsC,YAAY,UAC5BgF,EAAgB,MAIlB,IAAI/G,KACHzB,GAAI,SACJmC,GAAI,SAASwG,GACZ,MAAOA,GAAK9F,SAGb7C,GAAI,KACJmC,GAAI,SAASwG,GACZ,MAAiB,KAAVA,EAAKE,GAAWF,EAAK9F,SAG7B7C,GAAI,MACJmC,GAAI,SAASwG,GACZ,MAAoB,KAAbA,EAAKI,MAAcJ,EAAK9F,QAuFjCoG,aAAY,WACX,GAAIvE,GAAOwE,KAAKC,MAAMrB,KAAKW,MAAQ,KAC/BW,IAGJ,KAAKhB,EAAMiB,OACV,IAAK,GAAIC,GAAI,EAAOf,EAAJe,EAAcA,IAC7BlB,EAAMmB,QAAQ7E,EAAO4E,EAKvB,IAAIpH,GAAQkG,EAAM9D,QAAQI,EAC1B,IAAc,KAAVxC,EAAc,CACjBkG,EAAM3D,KAAKC,GACX0D,EAAMoB,OACN,KAAK,GAAI9I,KAAO4H,GAAO,CACtB,GAAI9G,GAAQ8G,EAAM5H,EAClBc,GAAMiD,KAAK,GACXjD,EAAMgI,SA6BR,GAvBAnB,EAAM9F,QAAQ,SAAS4D,GACtB,GAAIsD,GAAYP,KAAKC,MAAMhD,EAAMzB,KAAO,KACpCgE,EAAYvC,EAAMrE,KAClB4H,EAAWtB,EAAMA,EAAMiB,OAAS,GAChCM,EAAYvB,EAAM9D,QAAQmF,EAE9B,IAAkB,KAAdE,GAAoBF,EAAYC,EAEnC,WADAN,GAAU3E,KAAK0B,EAGhB,IAAIyD,GAAetB,EAAMI,EACpBkB,KACJA,EAAexB,EAAM1G,IAAI,WACxB,MAAO,KAER4G,EAAMI,GAAakB,EAEpB,IAAI/H,GAAQ+H,EAAa1H,EACzB0H,GAAa1H,GAAUL,EAAYA,EAAQ,EAAZ,IAEhCwG,EAAQe,GAGHzD,EACJ,OAAO,CAIR,IAAI2B,KACF,KAAKuC,OAAOzB,GAEd,KAAK,GAAIO,KAAQL,GAChBhB,EAAQ7C,MAAMkE,GAAMkB,OAAOvB,EAAMK,IAElCzB,GAAM4C,MACLxC,QAASA,IAIV/F,IACAkB,KAEE,KASHvB,EAAE,cAAc0E,GAAG,QAAS,WAI3B,MAHA1E,GAAE,gBAAgB6I,YAAY,UAC9B7I,EAAE,SAAS6I,YAAY,SACvB7I,EAAE,uBAAuB8F,SAClB,IAER9F,EAAE,cAAc0E,GAAG,SAAU,WAC5B,GAAIoE,GAAQ9I,EAAE,uBACVW,EAAQmI,EAAMlE,KAMlB,OALIjE,KACHP,EAAMmD,KAAK5C,GACXmI,EAAMlE,IAAI,IACV3E,MAEM,IAERD,EAAE,oBAAoB0E,GAAG,SAAU,WAClC,GAAIoE,GAAQ9I,EAAE,4BACVW,EAAQoI,SAASD,EAAMlE,MAAO,GAKlC,OAJKoE,OAAMrI,KACV2D,EAAUnE,IAAIQ,GACdmI,EAAMlE,IAAI,MAEJ,IAER5E,EAAE,kBAAkB0E,GAAG,QAAS,WAE/B,MADAL,GAAUlE,IAAIC,IACP,IAIRJ,EAAE,2BAA2B0E,GAAG,QAAS,WACxC,GAAIuE,GAAUC,KAAKC,WAClBC,IAAKjG,EACL/C,MAAOA,EACPkE,UAAWE,GAKZ,OAHA3E,GAAOwJ,eAAe,GAAIC,OAAML,IAC/B5C,KAAM,qBACH,iBACG,IAERrG,EAAE,QACA0E,GAAG,WAAY,SAASO,GACxB,GAAIsE,GAAgBtE,EAAMsE,aAE1B,OADAA,GAAcC,aAAaC,WAAa,QACjC,IAEP/E,GAAG,OAAQ,SAASO,GACpB,GAAIsE,GAAgBtE,EAAMsE,cACtBG,EAAOH,EAAcC,aAAaG,MAAM,GACxCC,EAAS,GAAIC,WAgBjB,OAfAD,GAAOE,OAAS,SAASC,GACxB,GAAI9G,GAAO,IACX,KACCA,EAAOiG,KAAKc,MAAMD,EAAEE,OAAOC,QAC1B,MAAOC,GACR,OAEGlH,IACHqB,EAAUnE,IAAI8C,EAAKqB,WACnBD,EAAUlE,IAAI8C,EAAKmG,KACnBhJ,EAAQ6C,EAAK7C,MACbH,MAGF2J,EAAOQ,WAAWV,IACX,IAgCT1J,EAAE,kBACA0E,GAAG,QAAS,mBAAoB7B,EAAK,KACrC6B,GAAG,QAAS,qBAAsB7B,EAAK,IACvC6B,GAAG,QAAS,uBAAwB,WACpC,GAAI1D,GAAQhB,EAAE+C,MAAMC,QAAQ,iBAAiBC,KAAK,QAGlD,OAFA7C,GAAMiK,OAAOrJ,EAAO,GACpBf,KACO,IAEPyE,GAAG,YAAa,gBAAiB,SAASO,GAC1C,IAAKjF,EAAE,SAASsK,SAAS,SACxB,OAAO,CAER,IAAIf,GAAgBtE,EAAMsE,cACtBT,EAAQ9I,EAAE+C,KACd+F,GAAMpG,SAAS,yBACf6G,EAAcC,aAAae,cAAgB,OAC3ChB,EAAcC,aAAagB,QAAQ,mBAAoBtB,KAAKC,WAC3DnI,MAAO8H,EAAM7F,KAAK,SAClBhB,KAAM6G,EAAM1G,KAAK,sBAAsBd,UAIxC6D,WAAW,WACVnF,EAAE,4DAA4D0C,SAAS,6BACrE,OAEHgC,GAAG,YAAa,gBAAiB,WACjC,GAAI+F,GAAQzK,EAAE+C,KACV0H,GAAMH,SAAS,6BAClBtK,EAAE+C,MAAML,SAAS,oCAGlBgC,GAAG,WAAY,gBAAiB,SAASO,GACzC,GAAIsE,GAAgBtE,EAAMsE,aAE1B,OADAA,GAAcC,aAAaC,WAAa,QACjC,IAEP/E,GAAG,YAAa,gBAAiB,SAASO,GAC1CA,EAAMyF,iBACNzF,EAAM0F,iBACN,IAAIF,GAAQzK,EAAE+C,KACd0H,GAAMnI,YAAY,oCAGlBoC,GAAG,UAAW,gBAAiB,WAC/B1E,EAAE+C,MAAMT,YAAY,yBACpBtC,EAAE,gCAAgCsC,YAAY,4BAC5CA,YAAY,oCAEdoC,GAAG,OAAQ,gBAAiB,SAASO,GACrC,GAAIsE,GAAgBtE,EAAMsE,cACtBqB,EAAc5K,EAAE+C,MAAME,KAAK,SAC3B4H,EAAc3B,KAAKc,MAAMT,EAAcC,aAAasB,QAAQ,qBAAqB9J,KAEjE,KAAhB4J,GAAsBA,IACzBA,EAAcxK,EAAM+H,QAGHyC,EAAdC,GACHD,GAED,IAAI3I,GAAO7B,EAAMiK,OAAOQ,EAAa,EAGrC,OAFAzK,GAAMiK,OAAOO,EAAa,EAAG3I,GAC7BhC,KACO,IAITD,EAAE,iBAAiB0E,GAAG,SAAU,SAASO,GAExCA,EAAMyF,iBAEN1K,EAAE+C,MAAMgI,OACR/K,EAAE,sBAAsBsC,YAAY,SACpC,IAAI0I,GAAQhL,EAAE,eAAe4E,KAE7BV,GAAK+G,gBAAgB,SAASC,EAAO7F,GACpC,GAAI6F,EAEH,WADA3F,SAAQC,IAAI,yBAA0B0F,EAGvC,IAAI5F,GAAMD,EAASC,GACnBpB,GAAKE,MAAM,SAAWkB,GAAKnF,IAAI6K,GAC/BhL,EAAE,YAAY+K,OACd/K,EAAE,iBAAiBmL,OACnBnL,EAAE,YAAY0C,SAAS,UACvB1C,EAAE,sBAAsB0C,SAAS,cAGnC1C,EAAE,eAAe0E,GAAG,QAAS,WAE5B,MADAR,GAAKkH,UACE,IAGRpL,EAAE,gCAAgC0E,GAAG,QAAS,WAU7C,MATA1E,GAAE,iBAAiB6I,YAAY,UAC/BpE,GAAgBA,EACZA,IACHpE,IACAkB,IACIvB,EAAE,SAASsK,SAAS,UACvBtK,EAAE,cAAcqL,QAAQ,WAGnB,IAERrL,EAAE,eAAe0E,GAAG,QAAS,WAC5B1E,EAAE,qBAAqB6I,YAAY,kBFgD/B,SAAShK,EAAQD,GAEtB,YG7nBM,SAASiI,GAAQyE,GACvB,MAAa,IAANA,EAAW,IAAMA,EAAM,GAAKA,EAI7B,QAASjC,GAAeJ,EAASsC,GACvC,GAAIC,GAAS3H,OAAO2H,QAAWC,UAAUC,YAAcD,UAAUC,WAAWC,KAAKF,UACjF,IAAID,EACHA,EAAOvC,EAASsC,OACV,CACN,GAAIK,GAAeC,SAASC,cAAc,KACtCC,EAAOlI,OAAOmI,IAAIC,gBAAgBhD,EACtC2C,GAAaM,aAAa,OAAQH,GAClCH,EAAaM,aAAa,WAAYX,GACtCM,SAASM,KAAKC,YAAYR,GAC1BA,EAAaS,QACbR,SAASM,KAAKG,YAAYV,IAIrB,QAASlE,GAAS6E,EAAQ/M,EAAKgN,GACrC,GAAI7L,GAAQ4L,EAAO/M,EACnB,OAAImB,GACIA,GAER4L,EAAO/M,GAAOgN,EACPA,GHqmBP/M,OAAOgN,eAAe7N,EAAS,cAC9B+B,OAAO,IAER/B,EAAQiI,QAAUA,EAClBjI,EAAQyK,eAAiBA,EACzBzK,EAAQ8I,SAAWA,GAkCd,SAAS7I,EAAQD,GAItB,YIxqBM,SAASkN,GAAcxK,EAAMN,EAAOW,EAAO+K,EAASC,EAAaC,GACpE,GAAIC,IACA,sCAAwCD,EAAc,yBAA2B,IAAM,KACrFD,EAAkD,GAApC,oBAAsB3L,EAAQ,KAAY,sBAC1D,QASJ,IANK2L,GACDE,EAAOtJ,KAAK,2EAGhBsJ,EAAOtJ,KAAK,4CAEPoJ,EAAa,CACd,GAAIG,GAAYnL,GAASA,EAAQ,IAAMX,CACvC6L,GAASA,EAAOlE,QACZ,uCACAmE,EAAY,yCAA2C,GACvDA,EAAY,0EAA4E,GACxFA,EAAY,OAAS,GACrB9L,EAAQ,uCAAyC,GACjDA,EAAQ,wEAA0E,GAClFA,EAAQ,OAAS,GACjB,2CACA,qEACA,SAIR6L,EAAOtJ,KAAK,eAEZ,IAAIwJ,GAAW/M,EAAE6M,EAAOG,KAAK,IAO7B,OANAD,GAAS9J,KAAK,QAASjC,GACvB+L,EAAS3K,KAAK,sBAAsBd,KAAKA,GACzCyL,EAASxK,KAAK,QAASjB,GACnBoL,GACAK,EAASrK,SAAS,oBAEfqK,EAMJ,QAASlI,GAAczE,EAAOoE,GACjC,GAAIyI,GAAoBjN,EAAE,kBACtBkN,KACAC,EAAU/M,EAAM+H,MACpB8E,GAAkBG,KAAK,IACnBD,GACAnN,EAAE,uBAAuB0C,SAAS,UAClCtC,EAAMiB,QAAQ,SAASC,EAAMN,GACrBwD,GAAkBxD,IAAUwD,GAC5ByI,EAAkBI,OAAOC,GAE7BL,EAAkBI,OAAOvB,EAAcxK,EAAMN,EAAOmM,EAASI,EAAUvM,KAAWM,GAAM,EAAON,GAASwD,IACxG0I,EAAalM,GAASM,IAG1B2L,EAAkBI,OAAO,8CAEzBrN,EAAE,uBAAuBsC,YAAY,UAGzCiL,EAAYL,EAGT,QAASpI,GAAgB3B,EAAgBqB,GAC5C,GAAIyI,GAAoBjN,EAAE,mBAC1BiN,GAAkBG,KAAK,IACvBjK,EAAe9B,QAAQ,SAASC,EAAMN,GAC9BwD,GAAkBxD,IAAUwD,GAC5ByI,EAAkBI,OAAOC,GAE7BL,EAAkBI,OAAOvB,EAAcxK,EAAMN,EAAO,MAAM,GAAM,EAAMA,GAASwD,MAIhF,QAASuB,GAAcyH,GAC1B,GAAIC,GAAUzN,EAAE,UAChByN,GAAQL,KAAK,GACb,KAAK,GAAI5N,KAAOgO,GACRA,EAAOhO,IACPiO,EAAQJ,OAAM,gBAAiB7N,EAAG,KAAKA,EAAG,SAK/C,QAAS0F,GAAyBlE,EAAOiE,GAC5C,GAAI6D,GAAQ9I,EAAE,iBAAmBgB,EAAQ,SACzC8H,GAAMxG,YAAY,kDAClBtC,EAAE,kBAAmB8I,GAChBxH,KAAK2D,EAAMrE,MACX0B,YAAY,sBACjB6C,WAAW,WACP2D,EAAMpG,SAAS,uBAAyBuC,EAAMnC,UAAY,EAAI,KAAO,SACrE9C,EAAE,kBAAmB8I,GAChBpG,SAAS,uBACf,IJwkBNjD,OAAOgN,eAAe7N,EAAS,cAC3B+B,OAAO,IAEX/B,EAAQkN,cAAgBA,EACxBlN,EAAQiG,cAAgBA,EACxBjG,EAAQkG,gBAAkBA,EAC1BlG,EAAQmH,cAAgBA,EACxBnH,EAAQsG,yBAA2BA,CIxoBpC,IAAIqI,MACAD,EAAkB","file":"roadmap.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/*global $ Firebase c3:true*/\n\t'use strict';\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj['default'] = obj; return newObj; } }\n\t\n\tvar _helper = __webpack_require__(1);\n\t\n\tvar helper = _interopRequireWildcard(_helper);\n\t\n\tvar _view = __webpack_require__(2);\n\t\n\tvar view = _interopRequireWildcard(_view);\n\t\n\t$(function () {\n\t\n\t\tvar hash = 'room_' + window.location.hash.replace(/[\\#\\.\\[\\]\\$]/g, '');\n\t\t// DEV - PROD switch\n\t\tvar baseDomain = window.location.host.indexOf('localhost') !== -1 ? 'roadmap2' : 'amber-torch-7267';\n\t\n\t\tvar base = new Firebase('https://' + baseDomain + '.firebaseio.com/');\n\t\tvar room = base.child(hash);\n\t\tvar roadmap = room.child('roadmap');\n\t\tvar reference = room.child('reference');\n\t\tvar threshold = room.child('threshold');\n\t\tvar history = room.child('history');\n\t\tvar presence = room.child('presence');\n\t\n\t\t/**\n\t  *\n\t  * SHARED VARS\n\t  *\n\t  */\n\t\n\t\tvar store = [];\n\t\tvar storeReference = [];\n\t\tvar thresholdValue = 0;\n\t\tvar showingStats = false;\n\t\n\t\t/**\n\t  *\n\t  * FUNCTIONAL\n\t  *\n\t  */\n\t\n\t\troadmap.on('value', function (newStoreResp) {\n\t\t\tstore = newStoreResp.val() || [];\n\t\t\tview.renderRoadmap(store, thresholdValue);\n\t\t});\n\t\treference.on('value', function (data) {\n\t\t\tstoreReference = data.val() || [];\n\t\t\tview.renderReference(storeReference, thresholdValue);\n\t\t});\n\t\tthreshold.on('value', function (data) {\n\t\t\tthresholdValue = data.val();\n\t\t\tview.renderRoadmap(store, thresholdValue);\n\t\t\tview.renderReference(storeReference, thresholdValue);\n\t\t});\n\t\n\t\tfunction broadcast() {\n\t\t\troadmap.set(store);\n\t\t}\n\t\thistory.limitToLast(1).on('child_added', function (childSnapshot) {\n\t\t\tvar event = childSnapshot.val();\n\t\t\tstore.forEach(function (text, index) {\n\t\t\t\tif (text === event.value) {\n\t\t\t\t\tview.renderActionNotification(index, event);\n\t\t\t\t}\n\t\t\t});\n\t\t\t// active user tracking\n\t\t\t$('#user_' + event.visa).removeClass('user-active');\n\t\t\tsetTimeout(function () {\n\t\t\t\t$('#user_' + event.visa).addClass('user-active');\n\t\t\t}, 10);\n\t\t});\n\t\n\t\t// login & presence\n\t\tvar visa;\n\t\tbase.onAuth(function (authData) {\n\t\t\tif (authData) {\n\t\t\t\tvar uid = authData.uid;\n\t\t\t\tconsole.log('Authenticated user with uid:', uid);\n\t\t\t\tbase.child('users/' + uid).on('value', function (data) {\n\t\t\t\t\tvisa = data.val();\n\t\t\t\t\t$('#main, nav, footer').removeClass('hidden');\n\t\t\t\t\t$('#welcome').addClass('hidden');\n\t\t\t\t\t$('#visa').text(visa);\n\t\n\t\t\t\t\t//  online status\n\t\t\t\t\tvar amOnline = base.child('.info/connected');\n\t\t\t\t\tvar userRef = room.child('presence/' + visa);\n\t\t\t\t\tamOnline.on('value', function (snapshot) {\n\t\t\t\t\t\tif (snapshot.val()) {\n\t\t\t\t\t\t\tuserRef.onDisconnect().remove();\n\t\t\t\t\t\t\tuserRef.set(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t$('#welcome').removeClass('hidden');\n\t\t\t\t$('#visa_input').focus();\n\t\t\t\t$('#main, #stats, nav, footer').addClass('hidden');\n\t\t\t\t$('#admin_block').addClass('hidden');\n\t\t\t}\n\t\t});\n\t\tpresence.on('value', function (data) {\n\t\t\tif (data) {\n\t\t\t\tview.displayOnline(data.val());\n\t\t\t}\n\t\t});\n\t\n\t\t/**\n\t  *\n\t  * CHARTING\n\t  *\n\t  */\n\t\tvar chart = c3.generate({\n\t\t\tdata: {\n\t\t\t\tx: 'x',\n\t\t\t\tcolumns: [['x']],\n\t\t\t\ttype: 'area-spline'\n\t\t\t},\n\t\t\taxis: {\n\t\t\t\ty: {\n\t\t\t\t\tpadding: 0\n\t\t\t\t},\n\t\t\t\tx: {\n\t\t\t\t\ttick: {\n\t\t\t\t\t\tformat: function format(x) {\n\t\t\t\t\t\t\tvar time = x * 10000;\n\t\t\t\t\t\t\tvar date = new Date(time);\n\t\t\t\t\t\t\treturn helper.format2(date.getHours()) + ':' + helper.format2(date.getMinutes());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\ttransition: {\n\t\t\t\tduration: 100\n\t\t\t}\n\t\t});\n\t\n\t\tvar times = [];\n\t\tvar saved = [];\n\t\tvar users = {};\n\t\tvar userStats = {};\n\t\tvar itemStats = {};\n\t\tvar nbPoints = 60;\n\t\tvar historyLength = 0;\n\t\n\t\thistory.on('child_added', function (childSnapshot) {\n\t\t\tvar event = childSnapshot.val();\n\t\t\tvar time = event.time;\n\t\t\tvar now = Date.now();\n\t\n\t\t\t// filter event which are too old (>2h)\n\t\t\tif (now - time > 720000) {\n\t\t\t\treturn;\n\t\t\t}\n\t\n\t\t\tsaved.push(event);\n\t\n\t\t\tvar eventVisa = event.visa;\n\t\t\tvar direction = event.direction;\n\t\t\tvar text = event.value;\n\t\t\tvar user = helper.getOrSet(userStats, eventVisa, {\n\t\t\t\tup: 0,\n\t\t\t\tdown: 0,\n\t\t\t\ttotal: 0,\n\t\t\t\ttoRef: 0,\n\t\t\t\tagainstRef: 0\n\t\t\t});\n\t\t\tvar item = helper.getOrSet(itemStats, text, {\n\t\t\t\tup: 0,\n\t\t\t\ttotal: 0,\n\t\t\t\tupUsers: {},\n\t\t\t\tdownUsers: {},\n\t\t\t\ttext: text\n\t\t\t});\n\t\n\t\t\tuser.total++;\n\t\t\titem.total++;\n\t\n\t\t\tif (direction > 0) {\n\t\t\t\tuser.down++;\n\t\t\t\thelper.getOrSet(item.downUsers, eventVisa, 0);\n\t\t\t\titem.downUsers[eventVisa]++;\n\t\t\t\tif (event.index >= event.refIndex) {\n\t\t\t\t\tuser.againstRef++;\n\t\t\t\t} else {\n\t\t\t\t\tuser.toRef++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.up++;\n\t\t\t\tuser.up++;\n\t\t\t\thelper.getOrSet(item.upUsers, eventVisa, 0);\n\t\t\t\titem.upUsers[eventVisa]++;\n\t\t\t\tif (event.index <= event.refIndex) {\n\t\t\t\t\tuser.againstRef++;\n\t\t\t\t} else {\n\t\t\t\t\tuser.toRef++;\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\t// show menu link if enough history\n\t\t\tif (historyLength !== -1 && historyLength++ > 10) {\n\t\t\t\t$('#nav_stats').removeClass('hidden');\n\t\t\t\thistoryLength = -1;\n\t\t\t}\n\t\t});\n\t\t// running\n\t\tvar statRules = [{\n\t\t\tid: 'active',\n\t\t\tfn: function fn(user) {\n\t\t\t\treturn user.total;\n\t\t\t}\n\t\t}, {\n\t\t\tid: 'up',\n\t\t\tfn: function fn(user) {\n\t\t\t\treturn user.up * 100 / user.total;\n\t\t\t}\n\t\t}, {\n\t\t\tid: 'ref',\n\t\t\tfn: function fn(user) {\n\t\t\t\treturn user.toRef * 100 / user.total;\n\t\t\t}\n\t\t}];\n\t\n\t\tfunction showUserStats() {\n\t\t\tvar stats = statRules.map(function (rule) {\n\t\t\t\treturn {\n\t\t\t\t\tid: rule.id,\n\t\t\t\t\tmost: {\n\t\t\t\t\t\tvalue: null,\n\t\t\t\t\t\tvisa: '???'\n\t\t\t\t\t},\n\t\t\t\t\tless: {\n\t\t\t\t\t\tvalue: null,\n\t\t\t\t\t\tvisa: '???'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t\t// compute results\n\t\t\tvar handleRule = function handleRule(currentVisa) {\n\t\t\t\treturn function (rule, index) {\n\t\t\t\t\tvar value = rule.fn(userStats[currentVisa]);\n\t\t\t\t\tvar stat = stats[index];\n\t\t\t\t\tvar most = stat.most;\n\t\t\t\t\tvar less = stat.less;\n\t\t\t\t\tif (most.value === null || value >= most.value) {\n\t\t\t\t\t\tmost.value = value;\n\t\t\t\t\t\tmost.visa = currentVisa;\n\t\t\t\t\t}\n\t\t\t\t\tif (less.value === null || value < less.value) {\n\t\t\t\t\t\tless.value = value;\n\t\t\t\t\t\tless.visa = currentVisa;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t\tfor (var userVisa in userStats) {\n\t\t\t\tstatRules.forEach(handleRule(userVisa));\n\t\t\t}\n\t\t\t// display results\n\t\t\tstats.forEach(function (stat) {\n\t\t\t\t$('#stats_most_' + stat.id + ' .stats-card-visa').text(stat.most.visa);\n\t\t\t\t$('#stats_less_' + stat.id + ' .stats-card-visa').text(stat.less.visa);\n\t\t\t});\n\t\t}\n\t\n\t\tfunction showItemStats() {\n\t\t\tvar totalSort = function totalSort(a, b) {\n\t\t\t\treturn b.total - a.total;\n\t\t\t};\n\t\t\t// get top 3\n\t\t\tvar items = Object.keys(itemStats).map(function (key) {\n\t\t\t\treturn itemStats[key];\n\t\t\t}).sort(totalSort);\n\t\n\t\t\tvar _loop = function (index) {\n\t\t\t\tvar item = items[index];\n\t\t\t\tvar $container = $('#stats_item_' + index);\n\t\t\t\tvar $upContainer = $container.find('.stats-card-up');\n\t\t\t\tvar $downContainer = $container.find('.stats-card-down');\n\t\t\t\tif (!item) {\n\t\t\t\t\t$container.addClass('hidden');\n\t\t\t\t} else {\n\t\t\t\t\t$container.removeClass('hidden').find('.stats-card-name').text(item.text).attr('title', item.total + ' actions');\n\t\n\t\t\t\t\t// find who vote for/against\n\t\t\t\t\tvar upUser = Object.keys(item.upUsers).map(function (key) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttotal: item.upUsers[key],\n\t\t\t\t\t\t\tvisa: key\n\t\t\t\t\t\t};\n\t\t\t\t\t}).sort(totalSort)[0];\n\t\t\t\t\tif (upUser) {\n\t\t\t\t\t\t$upContainer.removeClass('hidden').find('.stats-card-item-visa').text(upUser.visa);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$upContainer.addClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t\tvar downUser = Object.keys(item.downUsers).map(function (key) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttotal: item.downUsers[key],\n\t\t\t\t\t\t\tvisa: key\n\t\t\t\t\t\t};\n\t\t\t\t\t}).sort(totalSort)[0];\n\t\t\t\t\tif (downUser) {\n\t\t\t\t\t\t$downContainer.removeClass('hidden').find('.stats-card-item-visa').text(downUser.visa);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$downContainer.addClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\n\t\t\tfor (var index = 0; index < 3; index++) {\n\t\t\t\t_loop(index);\n\t\t\t}\n\t\t}\n\t\n\t\tsetInterval(function () {\n\t\t\tvar time = Math.floor(Date.now() / 10000);\n\t\t\tvar remaining = [];\n\t\n\t\t\t// initial build\n\t\t\tif (!times.length) {\n\t\t\t\tfor (var i = 0; i < nbPoints; i++) {\n\t\t\t\t\ttimes.unshift(time - i);\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\t// build new time\n\t\t\tvar index = times.indexOf(time);\n\t\t\tif (index === -1) {\n\t\t\t\ttimes.push(time);\n\t\t\t\ttimes.shift();\n\t\t\t\tfor (var key in users) {\n\t\t\t\t\tvar stats = users[key];\n\t\t\t\t\tstats.push(0);\n\t\t\t\t\tstats.shift();\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\t// reintegrate values\n\t\t\tsaved.forEach(function (event) {\n\t\t\t\tvar eventTime = Math.floor(event.time / 10000);\n\t\t\t\tvar eventVisa = event.visa;\n\t\t\t\tvar lastTime = times[times.length - 1];\n\t\t\t\tvar timeIndex = times.indexOf(eventTime);\n\t\t\t\t// save this for later\n\t\t\t\tif (timeIndex === -1 && eventTime > lastTime) {\n\t\t\t\t\tremaining.push(event);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar currentStats = users[eventVisa];\n\t\t\t\tif (!currentStats) {\n\t\t\t\t\tcurrentStats = times.map(function () {\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t});\n\t\t\t\t\tusers[eventVisa] = currentStats;\n\t\t\t\t}\n\t\t\t\tvar value = currentStats[index];\n\t\t\t\tcurrentStats[index] = !value ? 1 : value + 1;\n\t\t\t});\n\t\t\tsaved = remaining;\n\t\n\t\t\t// dont process if not showing\n\t\t\tif (!showingStats) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\n\t\t\t// propagate to chart\n\t\t\tvar columns = [['x'].concat(times)];\n\t\t\tfor (var user in users) {\n\t\t\t\tcolumns.push([user].concat(users[user]));\n\t\t\t}\n\t\t\tchart.load({\n\t\t\t\tcolumns: columns\n\t\t\t});\n\t\n\t\t\t// update stats as well\n\t\t\tshowUserStats();\n\t\t\tshowItemStats();\n\t\t}, 2000);\n\t\n\t\t/**\n\t  *\n\t  * DOM HANDLERS\n\t  *\n\t  */\n\t\n\t\t// roadmap handlers\n\t\t$('#nav_admin').on('click', function () {\n\t\t\t$('#admin_block').toggleClass('hidden');\n\t\t\t$('#main').toggleClass('admin');\n\t\t\t$('#admin_roadmap_item').focus();\n\t\t\treturn false;\n\t\t});\n\t\t$('#admin_add').on('submit', function () {\n\t\t\tvar $item = $('#admin_roadmap_item');\n\t\t\tvar value = $item.val();\n\t\t\tif (value) {\n\t\t\t\tstore.push(value);\n\t\t\t\t$item.val('');\n\t\t\t\tbroadcast();\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\t$('#admin_threshold').on('submit', function () {\n\t\t\tvar $item = $('#admin_roadmap_threshold');\n\t\t\tvar value = parseInt($item.val(), 10);\n\t\t\tif (!isNaN(value)) {\n\t\t\t\tthreshold.set(value);\n\t\t\t\t$item.val('');\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\t$('#nav_reference').on('click', function () {\n\t\t\treference.set(store);\n\t\t\treturn false;\n\t\t});\n\t\n\t\t// upload / download\n\t\t$('#roadmap_items_download').on('click', function () {\n\t\t\tvar content = JSON.stringify({\n\t\t\t\tref: storeReference,\n\t\t\t\tstore: store,\n\t\t\t\tthreshold: thresholdValue\n\t\t\t});\n\t\t\thelper.downloadAsFile(new Blob([content], {\n\t\t\t\ttype: 'application/json'\n\t\t\t}), 'roadmap.json');\n\t\t\treturn false;\n\t\t});\n\t\t$('body').on('dragover', function (event) {\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\toriginalEvent.dataTransfer.dropEffect = 'copy';\n\t\t\treturn false;\n\t\t}).on('drop', function (event) {\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\tvar file = originalEvent.dataTransfer.files[0];\n\t\t\tvar reader = new FileReader();\n\t\t\treader.onload = function (e) {\n\t\t\t\tvar data = null;\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.parse(e.target.result);\n\t\t\t\t} catch (X_x) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (data) {\n\t\t\t\t\tthreshold.set(data.threshold);\n\t\t\t\t\treference.set(data.ref);\n\t\t\t\t\tstore = data.store;\n\t\t\t\t\tbroadcast();\n\t\t\t\t}\n\t\t\t};\n\t\t\treader.readAsText(file);\n\t\t\treturn false;\n\t\t});\n\t\n\t\t// items handlers\n\t\tfunction swap(direction) {\n\t\t\treturn function () {\n\t\t\t\tvar index = $(this).parents('.roadmap-item').data('index');\n\t\t\t\tif (index === null) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// swap values\n\t\t\t\tvar value = store[index];\n\t\t\t\tstore[index] = store[index + direction];\n\t\t\t\tstore[index + direction] = value;\n\t\t\t\tbroadcast();\n\t\t\t\t// also save changed\n\t\t\t\tif (visa) {\n\t\t\t\t\tvar refIndex = storeReference.indexOf(value);\n\t\t\t\t\tvar historyRef = history.push();\n\t\t\t\t\thistoryRef.set({\n\t\t\t\t\t\tvisa: visa,\n\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\trefIndex: refIndex,\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\ttime: Firebase.ServerValue.TIMESTAMP,\n\t\t\t\t\t\tdirection: direction\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\n\t\t$('#roadmap_items').on('click', '.roadmap-item-up', swap(-1)).on('click', '.roadmap-item-down', swap(1)).on('click', '.roadmap-item-delete', function () {\n\t\t\tvar index = $(this).parents('.roadmap-item').data('index');\n\t\t\tstore.splice(index, 1);\n\t\t\tbroadcast();\n\t\t\treturn false;\n\t\t}).on('dragstart', '.roadmap-item', function (event) {\n\t\t\tif (!$('#main').hasClass('admin')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\tvar $item = $(this);\n\t\t\t$item.addClass('roadmap-item-dragging');\n\t\t\toriginalEvent.dataTransfer.effectAllowed = 'move';\n\t\t\toriginalEvent.dataTransfer.setData('application/json', JSON.stringify({\n\t\t\t\tindex: $item.data('index'),\n\t\t\t\titem: $item.find('.roadmap-item-name').text()\n\t\t\t}));\n\t\t\t// delay target placeholder display, otherwise stops the drag because\n\t\t\t// of the next element\n\t\t\tsetTimeout(function () {\n\t\t\t\t$('#roadmap_items .roadmap-item:not(.roadmap-item-dragging)').addClass('roadmap-item-drop-target');\n\t\t\t}, 100);\n\t\t}).on('dragenter', '.roadmap-item', function () {\n\t\t\tvar $this = $(this);\n\t\t\tif ($this.hasClass('roadmap-item-drop-target')) {\n\t\t\t\t$(this).addClass('roadmap-item-drop-target-enter');\n\t\t\t}\n\t\t}).on('dragover', '.roadmap-item', function (event) {\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\toriginalEvent.dataTransfer.dropEffect = 'move';\n\t\t\treturn false;\n\t\t}).on('dragleave', '.roadmap-item', function (event) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tvar $this = $(this);\n\t\t\t$this.removeClass('roadmap-item-drop-target-enter');\n\t\t}).on('dragend', '.roadmap-item', function () {\n\t\t\t$(this).removeClass('roadmap-item-dragging');\n\t\t\t$('#roadmap_items .roadmap-item').removeClass('roadmap-item-drop-target').removeClass('roadmap-item-drop-target-enter');\n\t\t}).on('drop', '.roadmap-item', function (event) {\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\tvar targetIndex = $(this).data('index');\n\t\t\tvar originIndex = JSON.parse(originalEvent.dataTransfer.getData('application/json')).index;\n\t\t\t// no index : push at the end\n\t\t\tif (targetIndex !== 0 && !targetIndex) {\n\t\t\t\ttargetIndex = store.length;\n\t\t\t}\n\t\t\t// removing will shift the index\n\t\t\tif (originIndex < targetIndex) {\n\t\t\t\ttargetIndex--;\n\t\t\t}\n\t\t\tvar item = store.splice(originIndex, 1);\n\t\t\tstore.splice(targetIndex, 0, item);\n\t\t\tbroadcast();\n\t\t\treturn false;\n\t\t});\n\t\n\t\t// login handlers\n\t\t$('#welcome form').on('submit', function (event) {\n\t\n\t\t\tevent.preventDefault();\n\t\t\t// toggle display\n\t\t\t$(this).hide();\n\t\t\t$('#welcome .progress').removeClass('hidden');\n\t\t\tvar login = $('#visa_input').val();\n\t\n\t\t\tbase.authAnonymously(function (error, authData) {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.log('Authentication Failed!', error);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar uid = authData.uid;\n\t\t\t\tbase.child('users/' + uid).set(login);\n\t\t\t\t$('#welcome').hide();\n\t\t\t\t$('#welcome form').show();\n\t\t\t\t$('#welcome').addClass('hidden');\n\t\t\t\t$('#welcome .progress').addClass('hidden');\n\t\t\t});\n\t\t});\n\t\t$('#nav_logout').on('click', function () {\n\t\t\tbase.unauth();\n\t\t\treturn false;\n\t\t});\n\t\n\t\t$('#nav_stats, #stats h2 .close').on('click', function () {\n\t\t\t$('#stats, #main').toggleClass('hidden');\n\t\t\tshowingStats = !showingStats;\n\t\t\tif (showingStats) {\n\t\t\t\tshowUserStats();\n\t\t\t\tshowItemStats();\n\t\t\t\tif ($('#main').hasClass('admin')) {\n\t\t\t\t\t$('#nav_admin').trigger('click');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\t$('#nav_toggle').on('click', function () {\n\t\t\t$('nav .navbar-right').toggleClass('hidden-xs');\n\t\t});\n\t});\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t\tvalue: true\n\t});\n\texports.format2 = format2;\n\texports.downloadAsFile = downloadAsFile;\n\texports.getOrSet = getOrSet;\n\t\n\tfunction format2(int) {\n\t\treturn int < 10 ? '0' + int : '' + int;\n\t}\n\t\n\t// stolen from piskel\n\t\n\tfunction downloadAsFile(content, filename) {\n\t\tvar saveAs = window.saveAs || navigator.msSaveBlob && navigator.msSaveBlob.bind(navigator);\n\t\tif (saveAs) {\n\t\t\tsaveAs(content, filename);\n\t\t} else {\n\t\t\tvar downloadLink = document.createElement('a');\n\t\t\tvar href = window.URL.createObjectURL(content);\n\t\t\tdownloadLink.setAttribute('href', href);\n\t\t\tdownloadLink.setAttribute('download', filename);\n\t\t\tdocument.body.appendChild(downloadLink);\n\t\t\tdownloadLink.click();\n\t\t\tdocument.body.removeChild(downloadLink);\n\t\t}\n\t}\n\t\n\tfunction getOrSet(object, key, defaultValue) {\n\t\tvar value = object[key];\n\t\tif (value) {\n\t\t\treturn value;\n\t\t}\n\t\tobject[key] = defaultValue;\n\t\treturn defaultValue;\n\t}\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t/*global $:true*/\n\t\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\texports.createElement = createElement;\n\texports.renderRoadmap = renderRoadmap;\n\texports.renderReference = renderReference;\n\texports.displayOnline = displayOnline;\n\texports.renderActionNotification = renderActionNotification;\n\t\n\tfunction createElement(text, index, total, changed, isReference, isCandidate) {\n\t    var markup = ['<div class=\"roadmap-item clearfix ' + (isCandidate ? 'roadmap-item-candidate' : '') + '\"' + (!isReference ? 'id=\"roadmap_item_' + index + '\"' : '') + '  draggable=\"true\">', '<div>'];\n\t\n\t    if (!isReference) {\n\t        markup.push('<span class=\"roadmap-item-grab-handle glyphicon glyphicon-move\"></span>');\n\t    }\n\t\n\t    markup.push('<span class=\"roadmap-item-name\"></span>');\n\t\n\t    if (!isReference) {\n\t        var isNotLast = total && total - 1 !== index;\n\t        markup = markup.concat(['<span class=\"roadmap-author\"></span>', isNotLast ? '<a href=\"#\" class=\"roadmap-item-down\">' : '', isNotLast ? '<span class=\"glyphicon glyphicon-arrow-down\" aria-hidden=\"true\"></span>' : '', isNotLast ? '</a>' : '', index ? '<a href=\"#\" class=\"roadmap-item-up\">' : '', index ? '<span class=\"glyphicon glyphicon-arrow-up\" aria-hidden=\"true\"></span>' : '', index ? '</a>' : '', '<a href=\"#\" class=\"roadmap-item-delete\">', '<span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span>', '</a>']);\n\t    }\n\t\n\t    markup.push('</div></div>');\n\t\n\t    var $element = $(markup.join(''));\n\t    $element.data('index', index);\n\t    $element.find('.roadmap-item-name').text(text);\n\t    $element.attr('title', text);\n\t    if (changed) {\n\t        $element.addClass('roadmap-item-new');\n\t    }\n\t    return $element;\n\t}\n\t\n\tvar storeView = [];\n\tvar thresholdMarkup = '<h5>Candidates</h5>';\n\t\n\tfunction renderRoadmap(store, thresholdValue) {\n\t    var $elementContainer = $('#roadmap_items');\n\t    var newStoreView = [];\n\t    var nbItems = store.length;\n\t    $elementContainer.html('');\n\t    if (nbItems) {\n\t        $('#roadmap_items_tips').addClass('hidden');\n\t        store.forEach(function (text, index) {\n\t            if (thresholdValue && index === thresholdValue) {\n\t                $elementContainer.append(thresholdMarkup);\n\t            }\n\t            $elementContainer.append(createElement(text, index, nbItems, storeView[index] !== text, false, index >= thresholdValue));\n\t            newStoreView[index] = text;\n\t        });\n\t        // add last element for DnD\n\t        $elementContainer.append('<div class=\"roadmap-item clearfix\"></div>');\n\t    } else {\n\t        $('#roadmap_items_tips').removeClass('hidden');\n\t    }\n\t    // keep a copy for the view\n\t    storeView = newStoreView;\n\t}\n\t\n\tfunction renderReference(storeReference, thresholdValue) {\n\t    var $elementContainer = $('#reference_items');\n\t    $elementContainer.html('');\n\t    storeReference.forEach(function (text, index) {\n\t        if (thresholdValue && index === thresholdValue) {\n\t            $elementContainer.append(thresholdMarkup);\n\t        }\n\t        $elementContainer.append(createElement(text, index, null, true, true, index >= thresholdValue));\n\t    });\n\t}\n\t\n\tfunction displayOnline(online) {\n\t    var $online = $('#online');\n\t    $online.html('');\n\t    for (var key in online) {\n\t        if (online[key]) {\n\t            $online.append('<li id=\"user_' + key + '\">' + key + '</li>');\n\t        }\n\t    }\n\t}\n\t\n\tfunction renderActionNotification(index, event) {\n\t    var $item = $('#roadmap_item_' + index + ' > div');\n\t    $item.removeClass('roadmap-item-notif-up, roadmap-item-notif-down');\n\t    $('.roadmap-author', $item).text(event.visa).removeClass('roadmap-author-new');\n\t    setTimeout(function () {\n\t        $item.addClass('roadmap-item-notif-' + (event.direction < 0 ? 'up' : 'down'));\n\t        $('.roadmap-author', $item).addClass('roadmap-author-new');\n\t    }, 10);\n\t}\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** roadmap.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 46666c62e8273f7a9d0f\n **/","/*global $ Firebase c3:true*/\nimport * as helper from './helper';\nimport * as view from './view';\n\n$(function() {\n\n\tvar hash = 'room_' + window.location.hash.replace(/[\\#\\.\\[\\]\\$]/g, '');\n\t// DEV - PROD switch\n\tvar baseDomain = window.location.host.indexOf('localhost') !== -1 ? 'roadmap2' : 'amber-torch-7267';\n\n\tvar base = new Firebase('https://' + baseDomain + '.firebaseio.com/');\n\tvar room = base.child(hash);\n\tvar roadmap = room.child('roadmap');\n\tvar reference = room.child('reference');\n\tvar threshold = room.child('threshold');\n\tvar history = room.child('history');\n\tvar presence = room.child('presence');\n\n\t/**\n\t *\n\t * SHARED VARS\n\t *\n\t */\n\n\tvar store = [];\n\tvar storeReference = [];\n\tvar thresholdValue = 0;\n\tvar showingStats = false;\n\n\t/**\n\t *\n\t * FUNCTIONAL\n\t *\n\t */\n\n\troadmap.on('value', function(newStoreResp) {\n\t\tstore = newStoreResp.val() || [];\n\t\tview.renderRoadmap(store, thresholdValue);\n\t});\n\treference.on('value', function(data) {\n\t\tstoreReference = data.val() || [];\n\t\tview.renderReference(storeReference, thresholdValue);\n\n\t});\n\tthreshold.on('value', function(data) {\n\t\tthresholdValue = data.val();\n\t\tview.renderRoadmap(store, thresholdValue);\n\t\tview.renderReference(storeReference, thresholdValue);\n\t});\n\n\tfunction broadcast() {\n\t\troadmap.set(store);\n\t}\n\thistory.limitToLast(1).on('child_added', function(childSnapshot) {\n\t\tvar event = childSnapshot.val();\n\t\tstore.forEach(function(text, index) {\n\t\t\tif (text === event.value) {\n\t\t\t\tview.renderActionNotification(index, event);\n\t\t\t}\n\t\t});\n\t\t// active user tracking\n\t\t$('#user_' + event.visa).removeClass('user-active');\n\t\tsetTimeout(function() {\n\t\t\t$('#user_' + event.visa).addClass('user-active');\n\t\t}, 10);\n\t});\n\n\t// login & presence\n\tvar visa;\n\tbase.onAuth(function(authData) {\n\t\tif (authData) {\n\t\t\tvar uid = authData.uid;\n\t\t\tconsole.log('Authenticated user with uid:', uid);\n\t\t\tbase.child('users/' + uid).on('value', function(data) {\n\t\t\t\tvisa = data.val();\n\t\t\t\t$('#main, nav, footer').removeClass('hidden');\n\t\t\t\t$('#welcome').addClass('hidden');\n\t\t\t\t$('#visa').text(visa);\n\n\t\t\t\t//  online status\n\t\t\t\tvar amOnline = base.child('.info/connected');\n\t\t\t\tvar userRef = room.child('presence/' + visa);\n\t\t\t\tamOnline.on('value', function(snapshot) {\n\t\t\t\t\tif (snapshot.val()) {\n\t\t\t\t\t\tuserRef.onDisconnect().remove();\n\t\t\t\t\t\tuserRef.set(true);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\t$('#welcome').removeClass('hidden');\n\t\t\t$('#visa_input').focus();\n\t\t\t$('#main, #stats, nav, footer').addClass('hidden');\n\t\t\t$('#admin_block').addClass('hidden');\n\t\t}\n\t});\n\tpresence.on('value', function(data) {\n\t\tif (data) {\n\t\t\tview.displayOnline(data.val());\n\t\t}\n\t});\n\n\t/**\n\t *\n\t * CHARTING\n\t *\n\t */\n\tvar chart = c3.generate({\n\t\tdata: {\n\t\t\tx: 'x',\n\t\t\tcolumns: [\n\t\t\t\t['x'],\n\t\t\t],\n\t\t\ttype: 'area-spline'\n\t\t},\n\t\taxis: {\n\t\t\ty: {\n\t\t\t\tpadding: 0\n\t\t\t},\n\t\t\tx: {\n\t\t\t\ttick: {\n\t\t\t\t\tformat: function(x) {\n\t\t\t\t\t\tvar time = x * 10000;\n\t\t\t\t\t\tvar date = new Date(time);\n\t\t\t\t\t\treturn helper.format2(date.getHours()) + ':' + helper.format2(date.getMinutes());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\ttransition: {\n\t\t\tduration: 100\n\t\t}\n\t});\n\n\n\tvar times = [];\n\tvar saved = [];\n\tvar users = {};\n\tvar userStats = {};\n\tvar itemStats = {};\n\tvar nbPoints = 60;\n\tvar historyLength = 0;\n\n\thistory.on('child_added', function(childSnapshot) {\n\t\tvar event = childSnapshot.val();\n\t\tvar time = event.time;\n\t\tvar now = Date.now();\n\n\t\t// filter event which are too old (>2h)\n\t\tif (now - time > 720000) {\n\t\t\treturn;\n\t\t}\n\n\t\tsaved.push(event);\n\n\t\tvar eventVisa = event.visa;\n\t\tvar direction = event.direction;\n\t\tvar text = event.value;\n\t\tvar user = helper.getOrSet(userStats, eventVisa, {\n\t\t\tup: 0,\n\t\t\tdown: 0,\n\t\t\ttotal: 0,\n\t\t\ttoRef: 0,\n\t\t\tagainstRef: 0\n\t\t});\n\t\tvar item = helper.getOrSet(itemStats, text, {\n\t\t\tup: 0,\n\t\t\ttotal: 0,\n\t\t\tupUsers: {},\n\t\t\tdownUsers: {},\n\t\t\ttext: text\n\t\t});\n\n\t\tuser.total++;\n\t\titem.total++;\n\n\t\tif (direction > 0) {\n\t\t\tuser.down++;\n\t\t\thelper.getOrSet(item.downUsers, eventVisa, 0);\n\t\t\titem.downUsers[eventVisa]++;\n\t\t\tif (event.index >= event.refIndex) {\n\t\t\t\tuser.againstRef++;\n\t\t\t} else {\n\t\t\t\tuser.toRef++;\n\t\t\t}\n\t\t} else {\n\t\t\titem.up++;\n\t\t\tuser.up++;\n\t\t\thelper.getOrSet(item.upUsers, eventVisa, 0);\n\t\t\titem.upUsers[eventVisa]++;\n\t\t\tif (event.index <= event.refIndex) {\n\t\t\t\tuser.againstRef++;\n\t\t\t} else {\n\t\t\t\tuser.toRef++;\n\t\t\t}\n\t\t}\n\n\t\t// show menu link if enough history\n\t\tif (historyLength !== -1 && historyLength++ > 10) {\n\t\t\t$('#nav_stats').removeClass('hidden');\n\t\t\thistoryLength = -1;\n\t\t}\n\t});\n\t// running\n\tvar statRules = [{\n\t\tid: 'active',\n\t\tfn: function(user) {\n\t\t\treturn user.total;\n\t\t}\n\t}, {\n\t\tid: 'up',\n\t\tfn: function(user) {\n\t\t\treturn user.up * 100 / user.total;\n\t\t}\n\t}, {\n\t\tid: 'ref',\n\t\tfn: function(user) {\n\t\t\treturn user.toRef * 100 / user.total;\n\t\t}\n\t}];\n\n\tfunction showUserStats() {\n\t\tvar stats = statRules.map(function(rule) {\n\t\t\treturn {\n\t\t\t\tid: rule.id,\n\t\t\t\tmost: {\n\t\t\t\t\tvalue: null,\n\t\t\t\t\tvisa: '???'\n\t\t\t\t},\n\t\t\t\tless: {\n\t\t\t\t\tvalue: null,\n\t\t\t\t\tvisa: '???'\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t\t// compute results\n\t\tvar handleRule = function(currentVisa) {\n\t\t\treturn function(rule, index) {\n\t\t\t\tvar value = rule.fn(userStats[currentVisa]);\n\t\t\t\tvar stat = stats[index];\n\t\t\t\tvar most = stat.most;\n\t\t\t\tvar less = stat.less;\n\t\t\t\tif (most.value === null || value >= most.value) {\n\t\t\t\t\tmost.value = value;\n\t\t\t\t\tmost.visa = currentVisa;\n\t\t\t\t}\n\t\t\t\tif (less.value === null || value < less.value) {\n\t\t\t\t\tless.value = value;\n\t\t\t\t\tless.visa = currentVisa;\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\tfor (var userVisa in userStats) {\n\t\t\tstatRules.forEach(handleRule(userVisa));\n\t\t}\n\t\t// display results\n\t\tstats.forEach(function(stat) {\n\t\t\t$('#stats_most_' + stat.id + ' .stats-card-visa').text(stat.most.visa);\n\t\t\t$('#stats_less_' + stat.id + ' .stats-card-visa').text(stat.less.visa);\n\t\t});\n\t}\n\n\tfunction showItemStats() {\n\t\tlet totalSort = (a, b) => b.total - a.total;\n\t\t// get top 3\n\t\tlet items = Object.keys(itemStats).map(key => itemStats[key])\n\t\t\t.sort(totalSort);\n\n\t\tfor (let index = 0; index < 3; index++) {\n\t\t\tlet item = items[index];\n\t\t\tlet $container = $(`#stats_item_${index}`);\n\t\t\tlet $upContainer = $container.find('.stats-card-up');\n\t\t\tlet $downContainer = $container.find('.stats-card-down');\n\t\t\tif (!item) {\n\t\t\t\t$container.addClass('hidden');\n\t\t\t} else {\n\t\t\t\t$container.removeClass('hidden')\n\t\t\t\t\t.find('.stats-card-name')\n\t\t\t\t\t.text(item.text)\n\t\t\t\t\t.attr('title', `${item.total} actions`);\n\n\t\t\t\t// find who vote for/against\n\t\t\t\tlet upUser = Object.keys(item.upUsers).map(key => ({\n\t\t\t\t\ttotal: item.upUsers[key],\n\t\t\t\t\tvisa: key\n\t\t\t\t})).sort(totalSort)[0];\n\t\t\t\tif (upUser) {\n\t\t\t\t\t$upContainer.removeClass('hidden').find('.stats-card-item-visa').text(upUser.visa);\n\t\t\t\t} else {\n\t\t\t\t\t$upContainer.addClass('hidden');\n\t\t\t\t}\n\t\t\t\tlet downUser = Object.keys(item.downUsers).map(key => ({\n\t\t\t\t\ttotal: item.downUsers[key],\n\t\t\t\t\tvisa: key\n\t\t\t\t})).sort(totalSort)[0];\n\t\t\t\tif (downUser) {\n\t\t\t\t\t$downContainer.removeClass('hidden').find('.stats-card-item-visa').text(downUser.visa);\n\t\t\t\t} else {\n\t\t\t\t\t$downContainer.addClass('hidden');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetInterval(function() {\n\t\tvar time = Math.floor(Date.now() / 10000);\n\t\tvar remaining = [];\n\n\t\t// initial build\n\t\tif (!times.length) {\n\t\t\tfor (var i = 0; i < nbPoints; i++) {\n\t\t\t\ttimes.unshift(time - i);\n\t\t\t}\n\t\t}\n\n\t\t// build new time\n\t\tvar index = times.indexOf(time);\n\t\tif (index === -1) {\n\t\t\ttimes.push(time);\n\t\t\ttimes.shift();\n\t\t\tfor (var key in users) {\n\t\t\t\tvar stats = users[key];\n\t\t\t\tstats.push(0);\n\t\t\t\tstats.shift();\n\n\t\t\t}\n\t\t}\n\n\t\t// reintegrate values\n\t\tsaved.forEach(function(event) {\n\t\t\tvar eventTime = Math.floor(event.time / 10000);\n\t\t\tvar eventVisa = event.visa;\n\t\t\tvar lastTime = times[times.length - 1];\n\t\t\tvar timeIndex = times.indexOf(eventTime);\n\t\t\t// save this for later\n\t\t\tif (timeIndex === -1 && eventTime > lastTime) {\n\t\t\t\tremaining.push(event);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar currentStats = users[eventVisa];\n\t\t\tif (!currentStats) {\n\t\t\t\tcurrentStats = times.map(function() {\n\t\t\t\t\treturn 0;\n\t\t\t\t});\n\t\t\t\tusers[eventVisa] = currentStats;\n\t\t\t}\n\t\t\tvar value = currentStats[index];\n\t\t\tcurrentStats[index] = !value ? 1 : value + 1;\n\t\t});\n\t\tsaved = remaining;\n\n\t\t// dont process if not showing\n\t\tif (!showingStats) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// propagate to chart\n\t\tvar columns = [\n\t\t\t['x'].concat(times)\n\t\t];\n\t\tfor (var user in users) {\n\t\t\tcolumns.push([user].concat(users[user]));\n\t\t}\n\t\tchart.load({\n\t\t\tcolumns: columns\n\t\t});\n\n\t\t// update stats as well\n\t\tshowUserStats();\n\t\tshowItemStats();\n\n\t}, 2000);\n\n\t/**\n\t *\n\t * DOM HANDLERS\n\t *\n\t */\n\n\t// roadmap handlers\n\t$('#nav_admin').on('click', function() {\n\t\t$('#admin_block').toggleClass('hidden');\n\t\t$('#main').toggleClass('admin');\n\t\t$('#admin_roadmap_item').focus();\n\t\treturn false;\n\t});\n\t$('#admin_add').on('submit', function() {\n\t\tvar $item = $('#admin_roadmap_item');\n\t\tvar value = $item.val();\n\t\tif (value) {\n\t\t\tstore.push(value);\n\t\t\t$item.val('');\n\t\t\tbroadcast();\n\t\t}\n\t\treturn false;\n\t});\n\t$('#admin_threshold').on('submit', function() {\n\t\tvar $item = $('#admin_roadmap_threshold');\n\t\tvar value = parseInt($item.val(), 10);\n\t\tif (!isNaN(value)) {\n\t\t\tthreshold.set(value);\n\t\t\t$item.val('');\n\t\t}\n\t\treturn false;\n\t});\n\t$('#nav_reference').on('click', function() {\n\t\treference.set(store);\n\t\treturn false;\n\t});\n\n\t// upload / download\n\t$('#roadmap_items_download').on('click', function() {\n\t\tvar content = JSON.stringify({\n\t\t\tref: storeReference,\n\t\t\tstore: store,\n\t\t\tthreshold: thresholdValue\n\t\t});\n\t\thelper.downloadAsFile(new Blob([content], {\n\t\t\ttype: 'application/json'\n\t\t}), 'roadmap.json');\n\t\treturn false;\n\t});\n\t$('body')\n\t\t.on('dragover', function(event) {\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\toriginalEvent.dataTransfer.dropEffect = 'copy';\n\t\t\treturn false;\n\t\t})\n\t\t.on('drop', function(event) {\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\tvar file = originalEvent.dataTransfer.files[0];\n\t\t\tvar reader = new FileReader();\n\t\t\treader.onload = function(e) {\n\t\t\t\tvar data = null;\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.parse(e.target.result);\n\t\t\t\t} catch (X_x) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (data) {\n\t\t\t\t\tthreshold.set(data.threshold);\n\t\t\t\t\treference.set(data.ref);\n\t\t\t\t\tstore = data.store;\n\t\t\t\t\tbroadcast();\n\t\t\t\t}\n\t\t\t};\n\t\t\treader.readAsText(file);\n\t\t\treturn false;\n\t\t});\n\n\t// items handlers\n\tfunction swap(direction) {\n\t\treturn function() {\n\t\t\tvar index = $(this).parents('.roadmap-item').data('index');\n\t\t\tif (index === null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// swap values\n\t\t\tvar value = store[index];\n\t\t\tstore[index] = store[index + direction];\n\t\t\tstore[index + direction] = value;\n\t\t\tbroadcast();\n\t\t\t// also save changed\n\t\t\tif (visa) {\n\t\t\t\tvar refIndex = storeReference.indexOf(value);\n\t\t\t\tvar historyRef = history.push();\n\t\t\t\thistoryRef.set({\n\t\t\t\t\tvisa: visa,\n\t\t\t\t\tindex: index,\n\t\t\t\t\trefIndex: refIndex,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\ttime: Firebase.ServerValue.TIMESTAMP,\n\t\t\t\t\tdirection: direction\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t}\n\n\t$('#roadmap_items')\n\t\t.on('click', '.roadmap-item-up', swap(-1))\n\t\t.on('click', '.roadmap-item-down', swap(1))\n\t\t.on('click', '.roadmap-item-delete', function() {\n\t\t\tvar index = $(this).parents('.roadmap-item').data('index');\n\t\t\tstore.splice(index, 1);\n\t\t\tbroadcast();\n\t\t\treturn false;\n\t\t})\n\t\t.on('dragstart', '.roadmap-item', function(event) {\n\t\t\tif (!$('#main').hasClass('admin')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\tvar $item = $(this);\n\t\t\t$item.addClass('roadmap-item-dragging');\n\t\t\toriginalEvent.dataTransfer.effectAllowed = 'move';\n\t\t\toriginalEvent.dataTransfer.setData('application/json', JSON.stringify({\n\t\t\t\tindex: $item.data('index'),\n\t\t\t\titem: $item.find('.roadmap-item-name').text()\n\t\t\t}));\n\t\t\t// delay target placeholder display, otherwise stops the drag because\n\t\t\t// of the next element\n\t\t\tsetTimeout(function() {\n\t\t\t\t$('#roadmap_items .roadmap-item:not(.roadmap-item-dragging)').addClass('roadmap-item-drop-target');\n\t\t\t}, 100);\n\t\t})\n\t\t.on('dragenter', '.roadmap-item', function() {\n\t\t\tvar $this = $(this);\n\t\t\tif ($this.hasClass('roadmap-item-drop-target')) {\n\t\t\t\t$(this).addClass('roadmap-item-drop-target-enter');\n\t\t\t}\n\t\t})\n\t\t.on('dragover', '.roadmap-item', function(event) {\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\toriginalEvent.dataTransfer.dropEffect = 'move';\n\t\t\treturn false;\n\t\t})\n\t\t.on('dragleave', '.roadmap-item', function(event) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tvar $this = $(this);\n\t\t\t$this.removeClass('roadmap-item-drop-target-enter');\n\n\t\t})\n\t\t.on('dragend', '.roadmap-item', function() {\n\t\t\t$(this).removeClass('roadmap-item-dragging');\n\t\t\t$('#roadmap_items .roadmap-item').removeClass('roadmap-item-drop-target')\n\t\t\t\t.removeClass('roadmap-item-drop-target-enter');\n\t\t})\n\t\t.on('drop', '.roadmap-item', function(event) {\n\t\t\tvar originalEvent = event.originalEvent;\n\t\t\tvar targetIndex = $(this).data('index');\n\t\t\tvar originIndex = JSON.parse(originalEvent.dataTransfer.getData('application/json')).index;\n\t\t\t// no index : push at the end\n\t\t\tif (targetIndex !== 0 && !targetIndex) {\n\t\t\t\ttargetIndex = store.length;\n\t\t\t}\n\t\t\t// removing will shift the index\n\t\t\tif (originIndex < targetIndex) {\n\t\t\t\ttargetIndex--;\n\t\t\t}\n\t\t\tvar item = store.splice(originIndex, 1);\n\t\t\tstore.splice(targetIndex, 0, item);\n\t\t\tbroadcast();\n\t\t\treturn false;\n\t\t});\n\n\t// login handlers\n\t$('#welcome form').on('submit', function(event) {\n\n\t\tevent.preventDefault();\n\t\t// toggle display\n\t\t$(this).hide();\n\t\t$('#welcome .progress').removeClass('hidden');\n\t\tvar login = $('#visa_input').val();\n\n\t\tbase.authAnonymously(function(error, authData) {\n\t\t\tif (error) {\n\t\t\t\tconsole.log('Authentication Failed!', error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar uid = authData.uid;\n\t\t\tbase.child('users/' + uid).set(login);\n\t\t\t$('#welcome').hide();\n\t\t\t$('#welcome form').show();\n\t\t\t$('#welcome').addClass('hidden');\n\t\t\t$('#welcome .progress').addClass('hidden');\n\t\t});\n\t});\n\t$('#nav_logout').on('click', function() {\n\t\tbase.unauth();\n\t\treturn false;\n\t});\n\n\t$('#nav_stats, #stats h2 .close').on('click', function() {\n\t\t$('#stats, #main').toggleClass('hidden');\n\t\tshowingStats = !showingStats;\n\t\tif (showingStats) {\n\t\t\tshowUserStats();\n\t\t\tshowItemStats();\n\t\t\tif ($('#main').hasClass('admin')) {\n\t\t\t\t$('#nav_admin').trigger('click');\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t});\n\t$('#nav_toggle').on('click', function() {\n\t\t$('nav .navbar-right').toggleClass('hidden-xs');\n\t});\n\n});\n\n\n\n/** WEBPACK FOOTER **\n ** C:/Users/BBA/Documents/GitHub/roadmap/source/js/roadmap.js\n **/","export function format2(int) {\n\treturn int < 10 ? '0' + int : '' + int;\n}\n\n// stolen from piskel\nexport function downloadAsFile(content, filename) {\n\tvar saveAs = window.saveAs || (navigator.msSaveBlob && navigator.msSaveBlob.bind(navigator));\n\tif (saveAs) {\n\t\tsaveAs(content, filename);\n\t} else {\n\t\tvar downloadLink = document.createElement('a');\n\t\tvar href = window.URL.createObjectURL(content);\n\t\tdownloadLink.setAttribute('href', href);\n\t\tdownloadLink.setAttribute('download', filename);\n\t\tdocument.body.appendChild(downloadLink);\n\t\tdownloadLink.click();\n\t\tdocument.body.removeChild(downloadLink);\n\t}\n}\n\nexport function getOrSet(object, key, defaultValue) {\n\tvar value = object[key];\n\tif (value) {\n\t\treturn value;\n\t}\n\tobject[key] = defaultValue;\n\treturn defaultValue;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** C:/Users/BBA/Documents/GitHub/roadmap/source/js/helper.js\n **/","/*global $:true*/\r\n\r\nexport function createElement(text, index, total, changed, isReference, isCandidate) {\r\n    let markup = [\r\n        '<div class=\"roadmap-item clearfix ' + (isCandidate ? 'roadmap-item-candidate' : '') + '\"' +\r\n        (!isReference ? 'id=\"roadmap_item_' + index + '\"' : '') + '  draggable=\"true\">',\r\n        '<div>'\r\n    ];\r\n\r\n    if (!isReference) {\r\n        markup.push('<span class=\"roadmap-item-grab-handle glyphicon glyphicon-move\"></span>');\r\n    }\r\n\r\n    markup.push('<span class=\"roadmap-item-name\"></span>');\r\n\r\n    if (!isReference) {\r\n        let isNotLast = total && total - 1 !== index;\r\n        markup = markup.concat([\r\n            '<span class=\"roadmap-author\"></span>',\r\n            isNotLast ? '<a href=\"#\" class=\"roadmap-item-down\">' : '',\r\n            isNotLast ? '<span class=\"glyphicon glyphicon-arrow-down\" aria-hidden=\"true\"></span>' : '',\r\n            isNotLast ? '</a>' : '',\r\n            index ? '<a href=\"#\" class=\"roadmap-item-up\">' : '',\r\n            index ? '<span class=\"glyphicon glyphicon-arrow-up\" aria-hidden=\"true\"></span>' : '',\r\n            index ? '</a>' : '',\r\n            '<a href=\"#\" class=\"roadmap-item-delete\">',\r\n            '<span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span>',\r\n            '</a>'\r\n        ]);\r\n    }\r\n\r\n    markup.push('</div></div>');\r\n\r\n    let $element = $(markup.join(''));\r\n    $element.data('index', index);\r\n    $element.find('.roadmap-item-name').text(text);\r\n    $element.attr('title', text);\r\n    if (changed) {\r\n        $element.addClass('roadmap-item-new');\r\n    }\r\n    return $element;\r\n}\r\n\r\nvar storeView = [];\r\nvar thresholdMarkup = '<h5>Candidates</h5>';\r\n\r\nexport function renderRoadmap(store, thresholdValue) {\r\n    let $elementContainer = $('#roadmap_items');\r\n    let newStoreView = [];\r\n    let nbItems = store.length;\r\n    $elementContainer.html('');\r\n    if (nbItems) {\r\n        $('#roadmap_items_tips').addClass('hidden');\r\n        store.forEach(function(text, index) {\r\n            if (thresholdValue && index === thresholdValue) {\r\n                $elementContainer.append(thresholdMarkup);\r\n            }\r\n            $elementContainer.append(createElement(text, index, nbItems, storeView[index] !== text, false, index >= thresholdValue));\r\n            newStoreView[index] = text;\r\n        });\r\n        // add last element for DnD\r\n        $elementContainer.append('<div class=\"roadmap-item clearfix\"></div>');\r\n    } else {\r\n        $('#roadmap_items_tips').removeClass('hidden');\r\n    }\r\n    // keep a copy for the view\r\n    storeView = newStoreView;\r\n}\r\n\r\nexport function renderReference(storeReference, thresholdValue) {\r\n    let $elementContainer = $('#reference_items');\r\n    $elementContainer.html('');\r\n    storeReference.forEach(function(text, index) {\r\n        if (thresholdValue && index === thresholdValue) {\r\n            $elementContainer.append(thresholdMarkup);\r\n        }\r\n        $elementContainer.append(createElement(text, index, null, true, true, index >= thresholdValue));\r\n    });\r\n}\r\n\r\nexport function displayOnline(online) {\r\n    let $online = $('#online');\r\n    $online.html('');\r\n    for (let key in online) {\r\n        if (online[key]) {\r\n            $online.append(`<li id=\"user_${key}\">${key}</li>`);\r\n        }\r\n    }\r\n}\r\n\r\nexport function renderActionNotification(index, event) {\r\n    let $item = $('#roadmap_item_' + index + ' > div');\r\n    $item.removeClass('roadmap-item-notif-up, roadmap-item-notif-down');\r\n    $('.roadmap-author', $item)\r\n        .text(event.visa)\r\n        .removeClass('roadmap-author-new');\r\n    setTimeout(function() {\r\n        $item.addClass('roadmap-item-notif-' + (event.direction < 0 ? 'up' : 'down'));\r\n        $('.roadmap-author', $item)\r\n            .addClass('roadmap-author-new');\r\n    }, 10);\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** C:/Users/BBA/Documents/GitHub/roadmap/source/js/view.js\n **/"],"sourceRoot":""}